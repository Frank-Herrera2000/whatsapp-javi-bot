<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WhatsApp Bot Universal House - Simulador v6 EDITABLE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #e5ddd5;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin: 0;
        }

        /* Header */
        .header {
            background: #075e54;
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.15);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .header-info {
            flex: 1;
        }

        .header-info h1 {
            font-size: 16px;
            font-weight: 500;
        }

        .header-info p {
            font-size: 13px;
            opacity: 0.9;
        }

        /* Edit Mode Toggle */
        .edit-mode-toggle {
            background: #25d366;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .edit-mode-toggle.active {
            background: #ff5722;
        }

        /* Estado de navegaciÃ³n */
        .navigation-state {
            background: #128c7e;
            color: white;
            padding: 8px 20px;
            font-size: 12px;
            font-family: monospace;
            display: none;
        }

        .navigation-state.active {
            display: block;
        }

        /* Container principal */
        .main-container {
            flex: 1;
            display: flex;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            overflow: hidden;
            height: calc(100vh - 60px);
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background: #f0f0f0;
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid #ddd;
        }

        .sidebar h2 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #075e54;
        }

        .quick-access {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .quick-button {
            background: white;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            text-align: left;
        }

        .quick-button:hover {
            background: #25d366;
            color: white;
            border-color: #25d366;
        }

        /* Export/Import Panel */
        .export-panel {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }

        .export-button, .import-button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .export-button {
            background: #4CAF50;
            color: white;
        }

        .import-button {
            background: #2196F3;
            color: white;
        }

        .export-button:hover {
            background: #45a049;
        }

        .import-button:hover {
            background: #1976D2;
        }

        /* Chat container */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYwIiBoZWlnaHQ9IjM2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cGF0dGVybiBpZD0iY2hhdC1iZyIgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiPjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjZTVkZGQ1Ii8+PHBhdGggZD0iTTAgMGwzMCAzMEwwIDYwTDMwIDkwTDAgMTIwTDMwIDE1MEwwIDE4MCIgc3Ryb2tlPSIjZGFkM2NjIiBzdHJva2Utd2lkdGg9IjAuNSIgZmlsbD0ibm9uZSIvPjwvcGF0dGVybj48L2RlZnM+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNjaGF0LWJnKSIvPjwvc3ZnPg==');
            position: relative;
            overflow: hidden;
        }

        /* Messages */
        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
            scroll-behavior: smooth;
        }

        .message {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 10px;
            position: relative;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            background: #dcf8c6;
            align-self: flex-end;
            margin-left: auto;
        }

        .message.bot {
            background: white;
            align-self: flex-start;
            box-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }

        /* Edit mode styles */
        .message.editable {
            cursor: text;
            border: 2px dashed transparent;
            transition: border 0.3s;
        }

        .message.editable:hover {
            border-color: #25d366;
        }

        .message.editing {
            border-color: #ff5722;
            background: #fff3e0;
        }

        .message-edit-area {
            width: 100%;
            min-height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            white-space: pre-wrap;
            overflow-y: auto;
        }

        .edit-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .edit-controls button {
            padding: 5px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .save-button {
            background: #4CAF50;
            color: white;
        }

        .cancel-button {
            background: #f44336;
            color: white;
        }

        .message-time {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
            text-align: right;
        }

        .state-info {
            font-size: 11px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        /* Typing indicator */
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 5px;
            padding: 15px;
            background: white;
            max-width: 80px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }

        .typing-indicator.show {
            display: flex;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% {
                transform: scale(1);
                opacity: 0.5;
            }
            40% {
                transform: scale(1.3);
                opacity: 1;
            }
        }

        /* Input area */
        .input-area {
            display: flex;
            padding: 10px;
            background: #f0f0f0;
            gap: 10px;
            align-items: flex-end;
            flex-shrink: 0;
        }

        .message-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 30px;
            outline: none;
            font-size: 14px;
            resize: none;
            max-height: 100px;
            overflow-y: auto;
        }

        .send-button {
            background: #25d366;
            color: white;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .send-button:hover {
            background: #128c7e;
        }

        .send-button svg {
            width: 24px;
            height: 24px;
        }

        /* Export modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #075e54;
        }

        .close-modal {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }

        .close-modal:hover {
            color: #000;
        }

        .export-textarea {
            width: 100%;
            min-height: 300px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }

        .copy-button {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background: #075e54;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .copy-button:hover {
            background: #064e47;
        }

        /* Responsive para iPhone 15 Pro Max (430x932) */
        @media (max-width: 430px) {
            .main-container {
                flex-direction: column;
                max-width: 100%;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #ddd;
                display: none;
                position: fixed;
                top: 60px;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 999;
                background: #f0f0f0;
            }
            
            .sidebar.mobile-show {
                display: block;
            }
            
            .message {
                max-width: 85%;
                font-size: 15px;
            }
            
            .header h1 {
                font-size: 14px;
            }
            
            .edit-mode-toggle {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .mobile-menu-btn {
                background: none;
                border: none;
                color: white;
                font-size: 24px;
                cursor: pointer;
                padding: 5px;
            }
            
            .modal-content {
                margin: 10% auto;
                width: 95%;
                padding: 15px;
            }
            
            .export-textarea {
                font-size: 11px;
            }
        }

        /* Estilos para markdown en mensajes */
        .message strong {
            font-weight: bold;
        }

        .message em {
            font-style: italic;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: #323232;
            color: white;
            padding: 12px 24px;
            border-radius: 5px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 3000;
        }

        .toast.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>
        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIyMDAiIGN5PSIyMDAiIHI9IjIwMCIgZmlsbD0iIzA3NWU1NCIvPjx0ZXh0IHg9IjIwMCIgeT0iMjIwIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+VUg8L3RleHQ+PC9zdmc+" alt="Universal House">
        <div class="header-info">
            <h1>Universal House - Javi Bot v6</h1>
            <p>ğŸŸ¢ En lÃ­nea - Modo Editable</p>
        </div>
        <button class="edit-mode-toggle" id="editModeToggle" onclick="toggleEditMode()">
            âœï¸ Editar
        </button>
    </div>

    <!-- Estado de navegaciÃ³n -->
    <div class="navigation-state" id="navigationState">
        Ruta actual: <span id="currentRoute">inicio</span>
    </div>

    <!-- Container principal -->
    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <h2>Accesos RÃ¡pidos</h2>
            <div class="quick-access">
                <button class="quick-button" onclick="quickAccess('inicio')">ğŸ  MenÃº Principal</button>
                <button class="quick-button" onclick="quickAccess('menu_informacion')">ğŸ“š InformaciÃ³n de Cursos</button>
                <button class="quick-button" onclick="quickAccess('submenu_precios')">ğŸ’° Precios</button>
                <button class="quick-button" onclick="quickAccess('info_examen')">ğŸ“ Examen de UbicaciÃ³n</button>
                <button class="quick-button" onclick="quickAccess('esperando_matricula')">ğŸ“ Portal de Alumnos</button>
                <button class="quick-button" onclick="quickAccess('atencion_humana')">ğŸ“ AtenciÃ³n Humana</button>
            </div>
            
            <h2>Estado del Bot</h2>
            <div style="background: white; padding: 10px; border-radius: 5px; font-size: 12px;">
                <p><strong>Estado actual:</strong> <span id="sidebarState">inicio</span></p>
                <p><strong>NavegaciÃ³n:</strong> <span id="sidebarNav">-</span></p>
                <p><strong>Modo:</strong> <span id="editModeStatus">VisualizaciÃ³n</span></p>
            </div>
            
            <div class="export-panel">
                <h2>Exportar/Importar</h2>
                <button class="export-button" onclick="exportChanges()">ğŸ“¤ Exportar Cambios</button>
                <button class="import-button" onclick="importChanges()">ğŸ“¥ Importar Cambios</button>
            </div>
        </div>

        <!-- Chat container -->
        <div class="chat-container">
            <div class="messages-container" id="messagesContainer">
                <!-- Los mensajes aparecerÃ¡n aquÃ­ -->
            </div>
            
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>

            <div class="input-area">
                <textarea 
                    class="message-input" 
                    id="messageInput" 
                    placeholder="Escribe un mensaje..."
                    rows="1"
                ></textarea>
                <button class="send-button" id="sendButton">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de ExportaciÃ³n -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Exportar Cambios</h2>
                <span class="close-modal" onclick="closeModal()">&times;</span>
            </div>
            <p>Copia este cÃ³digo y envÃ­alo a Claude para actualizar el bot:</p>
            <textarea id="exportData" class="export-textarea" readonly></textarea>
            <button class="copy-button" onclick="copyToClipboard()">ğŸ“‹ Copiar al Portapapeles</button>
        </div>
    </div>

    <!-- Toast notification -->
    <div id="toast" class="toast"></div>

    <script>
        // Estado del bot
        let botState = {
            currentState: 'inicio',
            navigationPath: [],
            editMode: false,
            editedStates: new Map()
        };

        // Estructura completa del flujo v6
        let flowData = [
            // MENU PRINCIPAL
            {
                state: "inicio",
                message: `ğŸ« *Universal House - Escuela de InglÃ©s*

ğŸ‘‹ Â¡Hola! Mi nombre es Javi y es un gusto para mÃ­ atenderte el dÃ­a de hoy.
Por favor brÃ­ndame la siguiente informaciÃ³n y con gusto te atenderÃ© de la mejor manera:

â€¢ 1ï¸âƒ£ ğŸŒğŸ’» Me interesa informaciÃ³n para ingresar a sus cursos
â€¢ 2ï¸âƒ£ ğŸ‘¨â€ğŸ“ğŸ‘©â€ğŸ“ Soy alumno/a de Universal House
â€¢ 3ï¸âƒ£ ğŸ“ Necesito hablar con una persona

ğŸ¤– Puedes indicarme Ãºnicamente el nÃºmero correspondiente. ğŸ¤—`,
                options: [
                    { text: "1", nextState: "menu_informacion" },
                    { text: "2", nextState: "esperando_matricula" },
                    { text: "3", nextState: "atencion_humana" }
                ]
            },

            // MENU 1 - INFORMACIÃ“N
            {
                state: "menu_informacion",
                message: `â€¢ 1. ğŸŒğŸ’» Me interesa informaciÃ³n para ingresar a sus cursos. ğŸ”»

ğŸ¤– Â¡Muy bien! Por favor indÃ­came que informaciÃ³n deseas conocer:

* 1 ğŸ’° InformaciÃ³n y costos de nuestros cursos.
* 2 ğŸ•’ Horarios de clases.
* 3 ğŸ“ Examen de ubicaciÃ³n.
* 4 âœğŸ» CÃ³mo realizo mi inscripciÃ³n?
* 5 ğŸ—“ï¸ Inicio de sus cursos.
* 6 â„¹ï¸ Quiero conocer toda la informaciÃ³n anterior.
* 7 ğŸ–ï¸ Deseo conocer sus niveles.
* 8 ğŸ“œ Certificaciones.
* 9 ğŸ•£ Quiero conocer sus horarios de atenciÃ³n.
* 10 ğŸªª Quiero conocer sus mÃ©todos de pago.
* 0 â¬…ï¸ Volver al menÃº principal

ğŸ¤– Puedes indicarme Ãºnicamente el nÃºmero correspondiente. ğŸ¤—`,
                options: [
                    { text: "1", nextState: "submenu_precios" },
                    { text: "2", nextState: "info_horarios" },
                    { text: "3", nextState: "info_examen" },
                    { text: "4", nextState: "info_inscripcion" },
                    { text: "5", nextState: "info_inicio" },
                    { text: "6", nextState: "info_general" },
                    { text: "7", nextState: "info_niveles" },
                    { text: "8", nextState: "info_certificaciones" },
                    { text: "9", nextState: "info_horarios_atencion" },
                    { text: "10", nextState: "info_metodos_pago" },
                    { text: "0", nextState: "inicio" }
                ]
            },

            // SUBMENU 1'1 - PRECIOS
            {
                state: "submenu_precios",
                message: `* 1 ğŸ’° InformaciÃ³n y costos de nuestros cursos. ğŸ”»

SUBMENÃš:
* 1 Curso Dominio (11 aÃ±os en adelante niveles BÃ¡sicos â€“ Intermedios)
* 2 Curso Kids (Alumnos 7 â€“ 10 aÃ±os Cualquier nivel)
* 3 Curso Mastery Course. (Alumnos 11 aÃ±os en adelante niveles de Perfeccionamiento B2 o mÃ¡s)
* 0 â¬…ï¸ Volver al menÃº de informaciÃ³n`,
                options: [
                    { text: "1", nextState: "info_curso_dominio" },
                    { text: "2", nextState: "info_curso_kids" },
                    { text: "3", nextState: "info_curso_mastery" },
                    { text: "0", nextState: "menu_informacion" }
                ]
            },

            // CURSO DOMINIO 1'1'1
            {
                state: "info_curso_dominio",
                message: `*1 Curso Dominio (11 aÃ±os en adelante niveles BÃ¡sicos â€“ Avanzados)*
ğŸ¤– Â¡Claro! Con gusto te comparto los precios de nuestros cursos en Universal House ğŸ«:

ğŸ“š *InformaciÃ³n para curso niveles A1-B1*

ğŸ”˜ *Frecuencia Semanal:* 4 horas semanales, 1 hora diaria de lunes a jueves. 
ğŸ’° Costo: $2,750.00 al mes.

ğŸ”¹ *Horario de lunes a jueves:*
     â€¢ 17:00 a 18:00 hrs
     â€¢ 18:00 a 19:00 hrs
     â€¢ 19:00 a 20:00 hrs

_El horario exacto dependerÃ¡ de tu nivel el cual podemos conocer mediante un examen de ubicaciÃ³n_

ğŸ”˜ *Frecuencia Sabatino:* 3 horas semanales, 3 horas de clase.
ğŸ’° Costo: $2,600.00 cada 4 semanas. (El pago no es mensual).

ğŸ”¸ *Horario sabatino:*
     â€¢ 8:00 a 11:00 hrs  
     â€¢ 11:00 a 14:00 hrs

_*El horario exacto dependerÃ¡ de tu nivel el cual podemos conocer mediante un examen de ubicaciÃ³n*_

ğŸ’³ *COSTOS ADICIONALES:*
ğŸ“‹ InscripciÃ³n: $580.00
ğŸ“š Material: $2,120.00 (DuraciÃ³n aprox. de 8-10 meses)

ğŸ“– El material consiste en 2 libros originales los cuales incluyen el acceso a una plataforma electrÃ³nica que podrÃ¡s utilizar desde casa.

â° *DURACIÃ“N DEL CURSO:*
â€¢ Curso semanal: 2 aÃ±os y medio
â€¢ Curso sabatino: 3 aÃ±os y medio

_Este tiempo puede reducirse, dependiendo el nivel en el que comiences._

ğŸ *BENEFICIO ESPECIAL:*
ğŸ¤– De igual manera, te comento que, si decides incorporarte a nuestros cursos este mes, contarÃ¡s con un servicio adicional por ser parte de nosotros; (En caso de faltar a tu clase presencial, tendrÃ¡s la opciÃ³n de visualizarla a distancia sin costo adicional y asÃ­ no perder ningÃºn avance estÃ©s donde estÃ©s).

âœ¨ Presiona 1 para continuar explorando nuestras opciones:

* 1 â¡ï¸ Continuar`,
                options: [
                    { text: "1", nextState: "menu_continuacion_dominio" }
                ]
            },

            // SEGUIMIENTO DOMINIO
            {
                state: "seguimiento_dominio",
                message: `ğŸš€ğŸ”¥ CAMBIO REALIZADO POR CLAUDE ğŸ”¥ğŸš€

ğŸ¤– Â¿Te gustarÃ­a conocer mÃ¡s informaciÃ³n sobre nuestros servicios?

âœ¨ Presiona 1 para continuar explorando nuestras opciones â¡ï¸

* 1 ğŸ¯ CONTINUAR (BOTÃ“N CLAUDE)
* 0 ğŸ‘‹ SALIR`,
                options: [
                    { text: "1", nextState: "menu_continuacion_dominio" }
                ]
            },

            // MENU CONTINUACION DOMINIO
            {
                state: "menu_continuacion_dominio",
                message: `ğŸ¤– Â¡Excelente! AquÃ­ tienes mÃ¡s opciones para complementar tu informaciÃ³n:

* 1 ğŸ“ Cursos de Perfeccionamiento Mastery B2
* 2 ğŸ“ Examen de UbicaciÃ³n
* 3 â¬…ï¸ Volver al menÃº de InformaciÃ³n y costos de nuestros cursos
* 4 ğŸ‘‹ Salir

ğŸ¤– Puedes indicarme Ãºnicamente el nÃºmero correspondiente. ğŸ¤—`,
                options: [
                    { text: "1", nextState: "info_curso_mastery_b2" },
                    { text: "2", nextState: "info_examen" },
                    { text: "3", nextState: "submenu_precios" },
                    { text: "4", nextState: "salir" }
                ]
            },

            // CURSO KIDS 1'1'2
            {
                state: "info_curso_kids",
                message: `*2 Curso Kids (Alumnos 7 â€“ 10 aÃ±os Cualquier nivel)*

ğŸ¤– Â¡Perfecto! Te proporciono los costos y horarios de nuestro curso de niÃ±os:

ğŸ”˜ *Frecuencia Semanal Kids:* 2 horas semanales
ğŸ’° Costo: $1,850.00 al mes

ğŸ”¹ *Horarios disponibles:*
     â€¢ Lunes y MiÃ©rcoles: 17:00 a 18:00 hrs
     â€¢ Martes y Jueves: 17:00 a 18:00 hrs
     â€¢ Lunes y MiÃ©rcoles: 18:00 a 19:00 hrs
     â€¢ Martes y Jueves: 18:00 a 19:00 hrs

ğŸ’³ *COSTOS ADICIONALES:*
ğŸ“‹ InscripciÃ³n: $580.00
ğŸ“š Material: $1,420.00 (2 libros originales con duraciÃ³n de 8 meses)

â° *DURACIÃ“N:*
_Depende de tu nivel y donde comiences, el tiempo puede reducirse._

ğŸ *BENEFICIO ESPECIAL:*
ğŸ¤– De igual manera, te comento que, si decides incorporarte a nuestros cursos este mes, contarÃ¡s con un servicio adicional por ser parte de nosotros; En caso de faltar a tu clase presencial, tendrÃ¡s la opciÃ³n de visualizarla a distancia sin costo adicional y asÃ­ no perder ningÃºn avance estÃ©s donde estÃ©s.

âœ¨ Presiona 1 para continuar explorando nuestras opciones:

* 1 â¡ï¸ Continuar
`,
                options: [
                    { text: "1", nextState: "menu_continuacion_kids" }
                ]
            },

            // MENU CONTINUACION KIDS
            {
                state: "menu_continuacion_kids",
                message: `ğŸ¤– Â¡Excelente! AquÃ­ tienes mÃ¡s opciones:

* 1 ğŸ“ Examen de UbicaciÃ³n para niÃ±os
* 2 ğŸ¯ InformaciÃ³n sobre Curso Dominio (11+ aÃ±os)
* 3 â¬…ï¸ Volver al menÃº de InformaciÃ³n y costos
* 4 ğŸ‘‹ Salir

ğŸ¤– Puedes indicarme Ãºnicamente el nÃºmero correspondiente. ğŸ¤—`,
                options: [
                    { text: "1", nextState: "info_examen" },
                    { text: "2", nextState: "info_curso_dominio" },
                    { text: "3", nextState: "submenu_precios" },
                    { text: "4", nextState: "salir" }
                ]
            },

            // CURSO MASTERY B2 - Desde el submenÃº inicial
            {
                state: "info_curso_mastery",
                message: `*3 Curso Mastery Course (Alumnos 11 aÃ±os en adelante niveles de Perfeccionamiento B2 o mÃ¡s)*

ğŸ¤– Â¡Claro que sÃ­! Con gusto te proporciono toda la informaciÃ³n de los cursos Mastery:

ğŸ“ *InformaciÃ³n para el nivel B2*

ğŸ”˜ *Frecuencia Semanal:* 4 horas semanales, 1 hora diaria de lunes a jueves
ğŸ’° Costo: $2,950.00 al mes

ğŸ”¹ *Horario de lunes a jueves:*
     â€¢ 18:00 a 19:00 hrs

ğŸ’³ *COSTOS ADICIONALES:*
ğŸ“‹ InscripciÃ³n: $580.00
ğŸ“š Material: $2,620.00 (DuraciÃ³n aprox. de 15 meses)

ğŸ“– *El material consiste en 2 libros originales*

ğŸ *BENEFICIO ESPECIAL:*
ğŸ¤– De igual manera, te comento que, si decides incorporarte a nuestros cursos este mes, contarÃ¡s con un servicio adicional por ser parte de nosotros; (En caso de faltar a tu clase presencial, tendrÃ¡s la opciÃ³n de visualizarla a distancia sin costo adicional y asÃ­ no perder ningÃºn avance estÃ©s donde estÃ©s).

âœ¨ Presiona 1 para continuar explorando nuestras opciones:

* 1 â¡ï¸ Continuar
`,
                options: [
                    { text: "1", nextState: "menu_continuacion_mastery_b2" },
                    { text: "0", nextState: "salir" }
                ]
            },

            // CURSO MASTERY B2 - Desde continuaciÃ³n de Dominio
            {
                state: "info_curso_mastery_b2",
                message: `ğŸ“ *CURSO MASTERY B2 (Upper Intermediate)*

ğŸ”˜ *Frecuencia Semanal:* 4 horas semanales, 1 hora diaria de lunes a jueves
ğŸ’° Costo: $2,950.00 al mes

ğŸ”¹ *Horario de lunes a jueves:*
     â€¢ 18:00 a 19:00 hrs

ğŸ’³ *COSTOS ADICIONALES:*
ğŸ“‹ InscripciÃ³n: $580.00
ğŸ“š Material: $2,620.00 (DuraciÃ³n aprox. de 15 meses)

ğŸ“– *El material consiste en 2 libros originales*

ğŸ *BENEFICIO ESPECIAL:*
ğŸ¤– De igual manera, te comento que, si decides incorporarte a nuestros cursos este mes, contarÃ¡s con un servicio adicional por ser parte de nosotros; (En caso de faltar a tu clase presencial, tendrÃ¡s la opciÃ³n de visualizarla a distancia sin costo adicional y asÃ­ no perder ningÃºn avance estÃ©s donde estÃ©s).

âœ¨ Presiona 1 para continuar explorando nuestras opciones:

* 1 â¡ï¸ Continuar
`,
                options: [
                    { text: "1", nextState: "menu_continuacion_mastery_b2" },
                    { text: "0", nextState: "salir" }
                ]
            },

            // MENU CONTINUACION MASTERY B2
            {
                state: "menu_continuacion_mastery_b2",
                message: `ğŸ¤– Â¡Perfecto! Â¿QuÃ© mÃ¡s te gustarÃ­a conocer?

* 1 ğŸ† Ver Curso C1 (Avanzado)
* 2 ğŸ“ Examen de UbicaciÃ³n
* 3 ğŸ“š Ver informaciÃ³n anterior (Curso Dominio A1-B1)
* 4 â¬…ï¸ Volver al menÃº de InformaciÃ³n y costos
* 5 ğŸ‘‹ Salir

ğŸ¤– Puedes indicarme Ãºnicamente el nÃºmero correspondiente. ğŸ¤—`,
                options: [
                    { text: "1", nextState: "info_curso_c1" },
                    { text: "2", nextState: "info_examen" },
                    { text: "3", nextState: "info_curso_dominio" },
                    { text: "4", nextState: "submenu_precios" },
                    { text: "5", nextState: "salir" }
                ]
            },

            // CURSO C1
            {
                state: "info_curso_c1", 
                message: `ğŸ† *CURSO MASTERY C1 (Advanced)*

ğŸ”˜ *Frecuencia Sabatino:* 3 horas semanales, 3 horas de clase
ğŸ’° Costo: $3,100.00 cada 4 semanas (El pago no es mensual)

ğŸ”¸ *Horario sabatino:*
     â€¢ 11:00 a 14:00 hrs

ğŸ’³ *COSTOS ADICIONALES:*
ğŸ“‹ InscripciÃ³n: $580.00
ğŸ“š Material: $2,620.00 (DuraciÃ³n aprox. de 18 meses)

â° *DURACIÃ“N:*
_Aproximadamente 18 meses_

ğŸ *BENEFICIO ESPECIAL:*
ğŸ¤– De igual manera, te comento que, si decides incorporarte a nuestros cursos este mes, contarÃ¡s con un servicio adicional por ser parte de nosotros; (En caso de faltar a tu clase presencial, tendrÃ¡s la opciÃ³n de visualizarla a distancia sin costo adicional y asÃ­ no perder ningÃºn avance estÃ©s donde estÃ©s).

âœ¨ Presiona 1 para continuar explorando nuestras opciones:

* 1 â¡ï¸ Continuar
`,
                options: [
                    { text: "1", nextState: "menu_continuacion_c1" },
                    { text: "0", nextState: "salir" }
                ]
            },

            // MENU CONTINUACION C1
            {
                state: "menu_continuacion_c1",
                message: `ğŸ¤– Â¡Excelente! AquÃ­ tienes mÃ¡s opciones:

* 1 ğŸ“ Examen de UbicaciÃ³n
* 2 ğŸ“ Ver informaciÃ³n anterior (Curso B2)
* 3 â¬…ï¸ Volver al menÃº de InformaciÃ³n y costos
* 4 ğŸ‘‹ Salir

ğŸ¤– Puedes indicarme Ãºnicamente el nÃºmero correspondiente. ğŸ¤—`,
                options: [
                    { text: "1", nextState: "info_examen" },
                    { text: "2", nextState: "info_curso_mastery_b2" },
                    { text: "3", nextState: "submenu_precios" },
                    { text: "4", nextState: "salir" }
                ]
            },

            // INFO HORARIOS 1'2
            {
                state: "info_horarios",
                message: `ğŸ•’ *HORARIOS DE CLASES*

ğŸ“… *CLASES ENTRE SEMANA (Lunes a Jueves):*
     â€¢ 17:00 - 18:00 hrs
     â€¢ 18:00 - 19:00 hrs
     â€¢ 19:00 - 20:00 hrs
_1 hora diaria, 4 horas semanales_

ğŸ“… *CLASES SABATINAS:*
     â€¢ 08:00 - 11:00 hrs
     â€¢ 11:00 - 14:00 hrs
_3 horas continuas_

ğŸ‘¶ *HORARIO KIDS (7-10 aÃ±os):*
     â€¢ Lunes y MiÃ©rcoles: 17:00 - 18:00 hrs
     â€¢ Martes y Jueves: 17:00 - 18:00 hrs
     â€¢ Lunes y MiÃ©rcoles: 18:00 - 19:00 hrs
     â€¢ Martes y Jueves: 18:00 - 19:00 hrs

ğŸ“ *HORARIOS MASTERY:*
     â€¢ B2: Lun-Jue 18:00-19:00 hrs
     â€¢ C1: SÃ¡bados 11:00-14:00 hrs

ğŸ“Œ *IMPORTANTE:*
     â€¢ Tu horario se asigna segÃºn tu nivel
     â€¢ Los grupos se forman con mÃ­nimo 5 alumnos
     â€¢ Puedes cambiar de horario al cambiar de nivel

âœ¨ Presiona 1 para continuar explorando nuestras opciones:

* 1 â¡ï¸ Continuar
`,
                options: [
                    { text: "1", nextState: "menu_continuacion_horarios" },
                    { text: "0", nextState: "salir" }
                ]
            },

            // MENU CONTINUACION HORARIOS
            {
                state: "menu_continuacion_horarios",
                message: `ğŸ¤– Â¡Excelente! AquÃ­ tienes mÃ¡s opciones:

* 1 ğŸ’° Ver costos de cursos
* 2 ğŸ“ Hacer examen de ubicaciÃ³n
* 3 â¬…ï¸ Volver al menÃº de informaciÃ³n
* 4 ğŸ‘‹ Salir

ğŸ¤– Puedes indicarme Ãºnicamente el nÃºmero correspondiente. ğŸ¤—`,
                options: [
                    { text: "1", nextState: "submenu_precios" },
                    { text: "2", nextState: "info_examen" },
                    { text: "3", nextState: "menu_informacion" },
                    { text: "4", nextState: "salir" }
                ]
            },

            // EXAMEN 1'3
            {
                state: "info_examen",
                message: `ğŸ“ *EXAMEN DE UBICACIÃ“N*

ğŸ¯ *Â¿Para quÃ© sirve?*
Determinar tu nivel actual de inglÃ©s y asignarte al grupo adecuado.

â±ï¸ *DuraciÃ³n:* 45-60 minutos

ğŸ’° *Costo:* GRATIS (se descuenta de tu inscripciÃ³n)

ğŸ“… *Horarios disponibles:*
â€¢ Lunes y MiÃ©rcoles: 19:00 hrs
â€¢ SÃ¡bados: 11:00 hrs

ğŸ“ *Lugar:*
Universal House - Portal Morelos Local 14
(A espaldas de presidencia municipal)

ğŸ“‹ *Â¿QuÃ© incluye?*
â€¢ EvaluaciÃ³n escrita (gramÃ¡tica y vocabulario)
â€¢ EvaluaciÃ³n oral (conversaciÃ³n)
â€¢ Resultados inmediatos
â€¢ RecomendaciÃ³n de nivel

âœ… *NO necesitas cita previa*
Solo presÃ©ntate 15 minutos antes en recepciÃ³n.

âœ¨ Presiona 1 para continuar explorando nuestras opciones:

* 1 â¡ï¸ Continuar
`,
                options: [
                    { text: "1", nextState: "menu_continuacion_examen" },
                    { text: "0", nextState: "salir" }
                ]
            },

            // MENU CONTINUACION EXAMEN
            {
                state: "menu_continuacion_examen",
                message: `ğŸ¤– Â¿QuÃ© te gustarÃ­a hacer ahora?

* 1 ğŸ“… Agendar mi examen
* 2 ğŸ’° Ver costos de cursos
* 3 â¬…ï¸ Volver al menÃº
* 4 ğŸ‘‹ Salir

ğŸ¤– Puedes indicarme Ãºnicamente el nÃºmero correspondiente. ğŸ¤—`,
                options: [
                    { text: "1", nextState: "agendar_examen" },
                    { text: "2", nextState: "submenu_precios" },
                    { text: "3", nextState: "menu_informacion" },
                    { text: "4", nextState: "salir" }
                ]
            },

            // INSCRIPCION 1'4
            {
                state: "info_inscripcion",
                message: `âœï¸ *PROCESO DE INSCRIPCIÃ“N*

ğŸ“‹ *REQUISITOS:*
â€¢ IdentificaciÃ³n oficial (INE/Pasaporte)
â€¢ Comprobante de domicilio
â€¢ 1 fotografÃ­a tamaÃ±o infantil
â€¢ Realizar examen de ubicaciÃ³n (gratis)

ğŸ’³ *COSTOS DE INSCRIPCIÃ“N:*
â€¢ InscripciÃ³n: $280 pesos
â€¢ Primera mensualidad
â€¢ Material didÃ¡ctico segÃºn el curso

ğŸ“… *PASOS PARA INSCRIBIRTE:*
1ï¸âƒ£ Realiza tu examen de ubicaciÃ³n
2ï¸âƒ£ Recibe tu resultado y nivel asignado
3ï¸âƒ£ Elige tu horario disponible
4ï¸âƒ£ Realiza el pago en caja o transferencia
5ï¸âƒ£ Â¡Listo! Recibe tu acceso digital

ğŸ¦ *FORMAS DE PAGO:*
â€¢ Efectivo en plantel
â€¢ Tarjeta de dÃ©bito/crÃ©dito
â€¢ Transferencia bancaria
â€¢ DepÃ³sito en OXXO

â° *HORARIO DE INSCRIPCIONES:*
Lunes a Viernes: 11:00-14:00 y 16:00-20:00
SÃ¡bados: 9:00-14:00

âœ¨ Presiona 1 para continuar explorando nuestras opciones:

* 1 â¡ï¸ Continuar
`,
                options: [
                    { text: "1", nextState: "menu_continuacion_inscripcion" },
                    { text: "0", nextState: "salir" }
                ]
            },

            // MENU CONTINUACION INSCRIPCION
            {
                state: "menu_continuacion_inscripcion",
                message: `ğŸ¤– Â¿QuÃ© deseas hacer ahora?

* 1 ğŸ“¤ Enviar comprobante de pago
* 2 ğŸ¦ Ver datos bancarios
* 3 ğŸ“ Hablar con alguien
* 4 â¬…ï¸ Volver al menÃº
* 5 ğŸ‘‹ Salir

ğŸ¤– Puedes indicarme Ãºnicamente el nÃºmero correspondiente. ğŸ¤—`,
                options: [
                    { text: "1", nextState: "enviar_comprobante" },
                    { text: "2", nextState: "datos_bancarios" },
                    { text: "3", nextState: "atencion_humana" },
                    { text: "4", nextState: "menu_informacion" },
                    { text: "5", nextState: "salir" }
                ]
            },

            // INICIO CURSOS 1'5
            {
                state: "info_inicio",
                message: `ğŸ—“ï¸ *INICIO DE CURSOS*

ğŸ“… *PRÃ“XIMOS INICIOS:*

ğŸ†• *GRUPOS NUEVOS (Nivel A1):*
â€¢ 6 de Enero 2025
â€¢ 3 de Febrero 2025
â€¢ 3 de Marzo 2025

ğŸ“š *GRUPOS ABIERTOS:*
Puedes integrarte cualquier lunes del mes si:
â€¢ Ya tienes conocimientos previos
â€¢ Realizaste examen de ubicaciÃ³n
â€¢ Hay cupo en tu nivel

â­ *CURSO KIDS:*
â€¢ Inicio: Primer martes de cada mes
â€¢ Grupos por edad (7-8 y 9-10 aÃ±os)

ğŸ“ *MASTERY B2/C1:*
â€¢ Inicio cada 2 meses
â€¢ PrÃ³ximo: 13 de Enero 2025

ğŸ’¡ *RECOMENDACIÃ“N:*
Realiza tu examen de ubicaciÃ³n con anticipaciÃ³n para apartar tu lugar.

âœ¨ Presiona 1 para continuar explorando nuestras opciones:

* 1 â¡ï¸ Continuar
`,
                options: [
                    { text: "1", nextState: "menu_continuacion_inicio" },
                    { text: "0", nextState: "salir" }
                ]
            },

            // MENU CONTINUACION INICIO
            {
                state: "menu_continuacion_inicio",
                message: `ğŸ¤– Â¿QuÃ© deseas hacer ahora?

* 1 ğŸ“ Hacer examen de ubicaciÃ³n
* 2 ğŸ’° Ver costos
* 3 â¬…ï¸ Volver al menÃº
* 4 ğŸ‘‹ Salir

ğŸ¤– Puedes indicarme Ãºnicamente el nÃºmero correspondiente. ğŸ¤—`,
                options: [
                    { text: "1", nextState: "info_examen" },
                    { text: "2", nextState: "submenu_precios" },
                    { text: "3", nextState: "menu_informacion" },
                    { text: "4", nextState: "salir" }
                ]
            },

            // INFO GENERAL 1'6
            {
                state: "info_general",
                message: `â„¹ï¸ *INFORMACIÃ“N COMPLETA DE UNIVERSAL HOUSE*

ğŸ« *SOBRE NOSOTROS:*
â€¢ 15 aÃ±os de experiencia
â€¢ MÃ©todo comunicativo moderno
â€¢ Clases presenciales y virtuales simultÃ¡neas
â€¢ Certificaciones internacionales

ğŸ“š *NUESTROS CURSOS:*

1ï¸âƒ£ *DOMINIO (11+ aÃ±os)*
â€¢ BÃ¡sico a Intermedio (A1-B1)
â€¢ 18 meses, $1,300/mes
â€¢ Lun-Jue o SÃ¡bados

2ï¸âƒ£ *KIDS (7-10 aÃ±os)*
â€¢ InglÃ©s para niÃ±os
â€¢ $1,100/mes
â€¢ Mar y Jue 17:00-19:00

3ï¸âƒ£ *MASTERY (B2-C1)*
â€¢ Perfeccionamiento
â€¢ B2: $1,600/mes, C1: $1,500/mes
â€¢ PreparaciÃ³n TOEFL/Cambridge

ğŸ’° *INVERSIÃ“N INICIAL:*
â€¢ InscripciÃ³n: $280
â€¢ Primera mensualidad
â€¢ Material: $850-$1,700

ğŸ“ *UBICACIÃ“N:*
Portal Morelos Local 14, Centro
(A espaldas de presidencia)

ğŸ“ *CONTACTO:*
Tel: 341 414 1215
Lun-Vie: 11:00-14:00 y 16:00-20:00

âœ¨ Presiona 1 para continuar explorando nuestras opciones:

* 1 â¡ï¸ Continuar
`,
                options: [
                    { text: "1", nextState: "menu_continuacion_general" },
                    { text: "0", nextState: "salir" }
                ]
            },

            // MENU CONTINUACION GENERAL
            {
                state: "menu_continuacion_general",
                message: `ğŸ¤– Â¿Necesitas algo mÃ¡s?

* 1 ğŸ“ Hacer examen gratis
* 2 ğŸ•’ Ver horarios
* 3 âœï¸ Proceso de inscripciÃ³n
* 4 â¬…ï¸ Volver al menÃº

ğŸ¤– Puedes indicarme Ãºnicamente el nÃºmero correspondiente. ğŸ¤—`,
                options: [
                    { text: "1", nextState: "info_examen" },
                    { text: "2", nextState: "info_horarios" },
                    { text: "3", nextState: "info_inscripcion" },
                    { text: "4", nextState: "menu_informacion" }
                ]
            },

            // NIVELES 1'7
            {
                state: "info_niveles",
                message: `ğŸ–ï¸ *NIVELES DE INGLÃ‰S - MARCO COMÃšN EUROPEO*

ğŸ“Š *ESTRUCTURA DE NIVELES:*

ğŸŸ¢ *BÃSICO:*
â€¢ A1 (Beginner) - 3 meses
â€¢ A2 (Elementary) - 3 meses

ğŸŸ¡ *INTERMEDIO:*
â€¢ B1 (Pre-Intermediate) - 3 meses
â€¢ B1+ (Intermediate) - 3 meses

ğŸŸ  *INTERMEDIO ALTO:*
â€¢ B2 (Upper Intermediate) - 6 meses

ğŸ”´ *AVANZADO:*
â€¢ C1 (Advanced) - 6 meses
â€¢ C2 (Proficiency) - EspecializaciÃ³n

ğŸ“ˆ *Â¿QUÃ‰ PUEDES HACER EN CADA NIVEL?*

*A1-A2:* ComunicaciÃ³n bÃ¡sica, presentarse, compras
*B1:* Conversaciones cotidianas, viajes, trabajo bÃ¡sico
*B2:* InglÃ©s profesional, presentaciones, negociaciÃ³n
*C1:* Dominio acadÃ©mico y profesional avanzado
*C2:* Nivel nativo, especializaciÃ³n profesional

ğŸ¯ *CERTIFICACIONES POR NIVEL:*
â€¢ A2: KET (Cambridge)
â€¢ B1: PET (Cambridge) / TOEFL 42-71
â€¢ B2: FCE (Cambridge) / TOEFL 72-94
â€¢ C1: CAE (Cambridge) / TOEFL 95-120

âœ¨ Presiona 1 para continuar explorando nuestras opciones:

* 1 â¡ï¸ Continuar
`,
                options: [
                    { text: "1", nextState: "menu_continuacion_niveles" },
                    { text: "0", nextState: "salir" }
                ]
            },

            // MENU CONTINUACION NIVELES
            {
                state: "menu_continuacion_niveles",
                message: `ğŸ¤– Â¿QuÃ© te gustarÃ­a hacer?

* 1 ğŸ“ Hacer examen de ubicaciÃ³n
* 2 ğŸ’° Ver costos por nivel
* 3 â¬…ï¸ Volver al menÃº
* 4 ğŸ‘‹ Salir

ğŸ¤– Puedes indicarme Ãºnicamente el nÃºmero correspondiente. ğŸ¤—`,
                options: [
                    { text: "1", nextState: "info_examen" },
                    { text: "2", nextState: "submenu_precios" },
                    { text: "3", nextState: "menu_informacion" },
                    { text: "4", nextState: "salir" }
                ]
            },

            // CERTIFICACIONES 1'8
            {
                state: "info_certificaciones",
                message: `ğŸ“œ *CERTIFICACIONES INTERNACIONALES*

ğŸŒ *CERTIFICACIONES DISPONIBLES:*

ğŸ“˜ *TOEFL (Test of English as Foreign Language)*
â€¢ Reconocido mundialmente
â€¢ VÃ¡lido para universidades USA/CanadÃ¡
â€¢ PreparaciÃ³n incluida en nivel B2
â€¢ Costo examen: $185 USD

ğŸ“• *CAMBRIDGE*
â€¢ KET (A2), PET (B1), FCE (B2), CAE (C1)
â€¢ Validez de por vida
â€¢ Reconocimiento europeo
â€¢ Costo: Desde $2,500 MXN

ğŸ“— *IELTS*
â€¢ Para estudios y migraciÃ³n
â€¢ UK, Australia, CanadÃ¡
â€¢ PreparaciÃ³n en nivel C1
â€¢ Costo: $4,500 MXN aprox

ğŸ“™ *TOEIC*
â€¢ InglÃ©s de negocios
â€¢ Requerido por empresas
â€¢ PreparaciÃ³n especial
â€¢ Costo: $1,800 MXN

ğŸ“ *PREPARACIÃ“N EN UNIVERSAL HOUSE:*
â€¢ Simulacros incluidos
â€¢ Material especializado
â€¢ Profesores certificados
â€¢ Grupos de preparaciÃ³n

âœ¨ Presiona 1 para continuar explorando nuestras opciones:

* 1 â¡ï¸ Continuar
`,
                options: [
                    { text: "1", nextState: "menu_continuacion_certificaciones" },
                    { text: "0", nextState: "salir" }
                ]
            },

            // MENU CONTINUACION CERTIFICACIONES
            {
                state: "menu_continuacion_certificaciones",
                message: `ğŸ¤– Â¿QuÃ© certificaciÃ³n te interesa?

* 1 ğŸ“˜ MÃ¡s info sobre TOEFL
* 2 ğŸ“• MÃ¡s info sobre Cambridge
* 3 â¬…ï¸ Volver al menÃº
* 4 ğŸ‘‹ Salir

ğŸ¤– Puedes indicarme Ãºnicamente el nÃºmero correspondiente. ğŸ¤—`,
                options: [
                    { text: "1", nextState: "info_toefl" },
                    { text: "2", nextState: "info_cambridge" },
                    { text: "3", nextState: "menu_informacion" },
                    { text: "4", nextState: "salir" }
                ]
            },

            // HORARIOS ATENCIÃ“N 1'9
            {
                state: "info_horarios_atencion",
                message: `ğŸ•£ *HORARIOS DE ATENCIÃ“N*

ğŸ¢ *OFICINA Y RECEPCIÃ“N:*

ğŸ“… *Lunes a Viernes:*
â€¢ MaÃ±ana: 11:00 - 14:00 hrs
â€¢ Tarde: 16:00 - 20:00 hrs

ğŸ“… *SÃ¡bados:*
â€¢ 9:00 - 14:00 hrs

ğŸ“… *Domingos:* Cerrado

â˜ï¸ *ATENCIÃ“N TELEFÃ“NICA:*
â€¢ Mismo horario que oficina
â€¢ WhatsApp: 24/7 (Bot Javi)
â€¢ Tel: 341 414 1215

ğŸ‘¥ *SERVICIOS DISPONIBLES:*
â€¢ Inscripciones
â€¢ Pagos de mensualidad
â€¢ InformaciÃ³n de cursos
â€¢ Entrega de constancias
â€¢ AtenciÃ³n a padres
â€¢ Cambios de horario

ğŸ“ *UBICACIÃ“N:*
Francisco I. Madero 1408
Col. Centro, Portal Morelos Local 14
(A espaldas de presidencia municipal)

ğŸš— *ESTACIONAMIENTO:*
Disponible en Plaza Portal Morelos

âœ¨ Presiona 1 para continuar explorando nuestras opciones:

* 1 â¡ï¸ Continuar
`,
                options: [
                    { text: "1", nextState: "menu_continuacion_horarios_atencion" },
                    { text: "0", nextState: "salir" }
                ]
            },

            // MENU CONTINUACION HORARIOS ATENCION
            {
                state: "menu_continuacion_horarios_atencion",
                message: `ğŸ¤– Â¿Necesitas algo mÃ¡s?

* 1 ğŸ“ Ver ubicaciÃ³n exacta
* 2 ğŸ“… Agendar una cita
* 3 â¬…ï¸ Volver al menÃº
* 4 ğŸ‘‹ Salir

ğŸ¤– Puedes indicarme Ãºnicamente el nÃºmero correspondiente. ğŸ¤—`,
                options: [
                    { text: "1", nextState: "ubicacion_mapa" },
                    { text: "2", nextState: "agendar_cita" },
                    { text: "3", nextState: "menu_informacion" },
                    { text: "4", nextState: "salir" }
                ]
            },

            // MÃ‰TODOS PAGO 1'10
            {
                state: "info_metodos_pago",
                message: `ğŸªª *MÃ‰TODOS DE PAGO*

ğŸ’³ *FORMAS DE PAGO ACEPTADAS:*

ğŸ’µ *EFECTIVO*
â€¢ Pago directo en caja
â€¢ Horario de oficina

ğŸ’³ *TARJETAS*
â€¢ DÃ©bito y CrÃ©dito
â€¢ Todas las tarjetas
â€¢ 3 y 6 meses sin intereses

ğŸ¦ *TRANSFERENCIA BANCARIA*
â€¢ BBVA Bancomer
â€¢ Cuenta: 1234567890
â€¢ CLABE: 012320001234567890
â€¢ A nombre de: Universal House S.C.

ğŸª *OXXO*
â€¢ Con nÃºmero de referencia
â€¢ Solicitar en recepciÃ³n

ğŸ“± *PAGO EN LÃNEA*
â€¢ PayPal disponible
â€¢ Mercado Pago

ğŸ’° *PLANES DE PAGO:*
â€¢ Mensual: Sin descuento
â€¢ Trimestral: 5% descuento
â€¢ Semestral: 10% descuento
â€¢ Anual: 15% descuento

ğŸ *PROMOCIONES VIGENTES:*
â€¢ 2x1 en inscripciÃ³n (hermanos)
â€¢ 20% desc. empleados gobierno
â€¢ Beca del 30% promedio 9.0+

âœ¨ Presiona 1 para continuar explorando nuestras opciones:

* 1 â¡ï¸ Continuar
`,
                options: [
                    { text: "1", nextState: "menu_continuacion_metodos_pago" },
                    { text: "0", nextState: "salir" }
                ]
            },

            // MENU CONTINUACION METODOS PAGO
            {
                state: "menu_continuacion_metodos_pago",
                message: `ğŸ¤– Selecciona:

* 1 ğŸ¦ Ver datos bancarios completos
* 2 ğŸ“§ Solicitar factura
* 3 â¬…ï¸ Volver al menÃº
* 4 ğŸ‘‹ Salir

ğŸ¤– Puedes indicarme Ãºnicamente el nÃºmero correspondiente. ğŸ¤—`,
                options: [
                    { text: "1", nextState: "datos_bancarios" },
                    { text: "2", nextState: "solicitar_factura" },
                    { text: "3", nextState: "menu_informacion" },
                    { text: "4", nextState: "salir" }
                ]
            },

            // MENU 2 - ALUMNOS
            {
                state: "esperando_matricula",
                message: `ğŸ“š *Acceso para Alumnos*

Por favor ingresa tu nÃºmero de *matrÃ­cula*:

_Ejemplo: ENG2301_`,
                options: []
            },


            {
                state: "menu_alumno",
                message: `âœ… *Welcome back!*

Bienvenido/a ğŸ“

Â¿En quÃ© puedo ayudarte hoy?

1ï¸âƒ£ Ver mi progreso acadÃ©mico
2ï¸âƒ£ Consultar horarios
3ï¸âƒ£ Solicitar constancia
4ï¸âƒ£ Pagos y adeudos
5ï¸âƒ£ ContraseÃ±a clase grabada
6ï¸âƒ£ Material de estudio
7ï¸âƒ£ Cambio de grupo/horario
8ï¸âƒ£ Solicitar baja
9ï¸âƒ£ InformaciÃ³n de exÃ¡menes
ğŸ”Ÿ Certificaciones internacionales
1ï¸âƒ£1ï¸âƒ£ Problemas con plataforma
1ï¸âƒ£2ï¸âƒ£ Hablar con mi teacher

0ï¸âƒ£ Volver al menÃº principal`,
                options: [
                    { text: "1", nextState: "progreso_academico" },
                    { text: "2", nextState: "consultar_horarios" },
                    { text: "3", nextState: "solicitar_constancia" },
                    { text: "4", nextState: "pagos_adeudos" },
                    { text: "5", nextState: "password_clase" },
                    { text: "6", nextState: "material_estudio" },
                    { text: "7", nextState: "cambio_horario" },
                    { text: "8", nextState: "solicitar_baja" },
                    { text: "9", nextState: "info_examenes_alumno" },
                    { text: "10", nextState: "certificaciones_alumno" },
                    { text: "11", nextState: "problemas_plataforma" },
                    { text: "12", nextState: "contactar_teacher" },
                    { text: "0", nextState: "inicio" }
                ]
            },

            // MENU 3 - ATENCIÃ“N HUMANA
            {
                state: "atencion_humana",
                message: `ğŸ“ *Solicitud de atenciÃ³n personal*

Tu solicitud ha sido registrada. Un miembro de nuestro equipo se comunicarÃ¡ contigo durante nuestro horario de servicio.

â° *Horario de atenciÃ³n:*
Lunes a Viernes: 8:00 AM - 6:00 PM

Mientras tanto, Â¿hay algo especÃ­fico en lo que pueda ayudarte?

1ï¸âƒ£ Me interesa informaciÃ³n de cursos
2ï¸âƒ£ Soy alumno de Universal House
3ï¸âƒ£ Cancelar y salir`,
                options: [
                    { text: "1", nextState: "menu_informacion" },
                    { text: "2", nextState: "esperando_matricula" },
                    { text: "3", nextState: "salir" }
                ]
            },

            // Estados adicionales
            {
                state: "salir",
                message: `ğŸ‘‹ *Â¡Hasta luego!*

Gracias por contactar a Universal House. 

Â¡Que tengas un excelente dÃ­a! 
*Have a great day!* ğŸŒŸ

Si necesitas algo mÃ¡s, escribe "hola" para comenzar de nuevo.`,
                options: []
            }
        ];

        // Mapa de respuestas
        const responseMap = {
            'inicio': {
                '1': 'menu_informacion',
                '2': 'esperando_matricula',
                '3': 'atencion_humana'
            },
            'menu_informacion': {
                '1': 'submenu_precios',
                '2': 'info_horarios',
                '3': 'info_examen',
                '4': 'info_inscripcion',
                '5': 'info_inicio',
                '6': 'info_general',
                '7': 'info_niveles',
                '8': 'info_certificaciones',
                '9': 'info_horarios_atencion',
                '10': 'info_metodos_pago',
                '0': 'inicio'
            },
            'submenu_precios': {
                '1': 'info_curso_dominio',
                '2': 'info_curso_kids',
                '3': 'info_curso_mastery',
                '0': 'menu_informacion'
            },
            'info_curso_dominio': {
                '1': 'menu_continuacion_dominio'
            },
            'seguimiento_dominio': {
                '1': 'menu_continuacion_dominio',
                '0': 'salir'
            },
            'menu_continuacion_dominio': {
                '1': 'info_curso_mastery_b2',
                '2': 'info_examen',
                '3': 'submenu_precios',
                '4': 'salir'
            },
            'info_curso_kids': {
                '1': 'menu_continuacion_kids'
            },
            'menu_continuacion_kids': {
                '1': 'info_examen',
                '2': 'info_curso_dominio',
                '3': 'submenu_precios',
                '4': 'salir'
            },
            'info_curso_mastery': {
                '1': 'menu_continuacion_mastery_b2'
            },
            'info_curso_mastery_b2': {
                '1': 'menu_continuacion_mastery_b2'
            },
            'menu_continuacion_mastery_b2': {
                '1': 'info_curso_c1',
                '2': 'info_examen',
                '3': 'info_curso_dominio',
                '4': 'submenu_precios',
                '5': 'salir'
            },
            'info_curso_c1': {
                '1': 'menu_continuacion_c1'
            },
            'menu_continuacion_c1': {
                '1': 'info_examen',
                '2': 'info_curso_mastery_b2',
                '3': 'submenu_precios',
                '4': 'salir'
            },
            'info_horarios': {
                '1': 'menu_continuacion_horarios'
            },
            'menu_continuacion_horarios': {
                '1': 'submenu_precios',
                '2': 'info_examen',
                '3': 'menu_informacion',
                '4': 'salir'
            },
            'info_examen': {
                '1': 'menu_continuacion_examen'
            },
            'menu_continuacion_examen': {
                '1': 'agendar_examen',
                '2': 'submenu_precios',
                '3': 'menu_informacion',
                '4': 'salir'
            },
            'info_inscripcion': {
                '1': 'menu_continuacion_inscripcion'
            },
            'menu_continuacion_inscripcion': {
                '1': 'enviar_comprobante',
                '2': 'datos_bancarios',
                '3': 'atencion_humana',
                '4': 'menu_informacion',
                '5': 'salir'
            },
            'info_inicio': {
                '1': 'menu_continuacion_inicio'
            },
            'menu_continuacion_inicio': {
                '1': 'info_examen',
                '2': 'submenu_precios',
                '3': 'menu_informacion',
                '4': 'salir'
            },
            'info_general': {
                '1': 'menu_continuacion_general'
            },
            'menu_continuacion_general': {
                '1': 'info_examen',
                '2': 'info_horarios',
                '3': 'info_inscripcion',
                '4': 'menu_informacion'
            },
            'info_niveles': {
                '1': 'menu_continuacion_niveles'
            },
            'menu_continuacion_niveles': {
                '1': 'info_examen',
                '2': 'submenu_precios',
                '3': 'menu_informacion',
                '4': 'salir'
            },
            'info_certificaciones': {
                '1': 'menu_continuacion_certificaciones'
            },
            'menu_continuacion_certificaciones': {
                '1': 'info_toefl',
                '2': 'info_cambridge',
                '3': 'menu_informacion',
                '4': 'salir'
            },
            'info_horarios_atencion': {
                '1': 'menu_continuacion_horarios_atencion'
            },
            'menu_continuacion_horarios_atencion': {
                '1': 'ubicacion_mapa',
                '2': 'agendar_cita',
                '3': 'menu_informacion',
                '4': 'salir'
            },
            'info_metodos_pago': {
                '1': 'menu_continuacion_metodos_pago'
            },
            'menu_continuacion_metodos_pago': {
                '1': 'datos_bancarios',
                '2': 'solicitar_factura',
                '3': 'menu_informacion',
                '4': 'salir'
            },
            'menu_alumno': {
                '1': 'progreso_academico',
                '2': 'consultar_horarios',
                '3': 'solicitar_constancia',
                '4': 'pagos_adeudos',
                '5': 'password_clase',
                '6': 'material_estudio',
                '7': 'cambio_horario',
                '8': 'solicitar_baja',
                '9': 'info_examenes_alumno',
                '10': 'certificaciones_alumno',
                '11': 'problemas_plataforma',
                '12': 'contactar_teacher',
                '0': 'inicio'
            },
            'atencion_humana': {
                '1': 'menu_informacion',
                '2': 'esperando_matricula',
                '3': 'salir'
            }
        };

        // Base de datos de alumnos - Ejemplos para pruebas
        // NOTA: El bot real tiene acceso a los 134 alumnos desde auth-alumnos.js
        const studentsDB = {
            // Algunos ejemplos para el simulador
            "17087": { "nombre": "ADRIANA CONTRERAS PICHARDO", "colegiatura": 2200, "tipo": "ST" },
            "23101": { "nombre": "DANA MICHELLE ARENAS MEDINA", "colegiatura": 2200, "tipo": "ST" },
            "24112": { "nombre": "REBECA ESTEFANIA LOPEZ FLORES", "colegiatura": 2400, "tipo": "ST" },
            "24120": { "nombre": "PAULINA SOFIA CHAPA LOPEZ", "colegiatura": 2400, "tipo": "ST" },
            "24501": { "nombre": "LEONARDO GARCIA RODRIGUEZ", "colegiatura": 2400, "tipo": "ST" },
            "24606": { "nombre": "SARA PAULA ESPINOSA PASCACIO", "colegiatura": 2750, "tipo": "SE" },
            "24901": { "nombre": "IUHANY PALMA SUAREZ", "colegiatura": 2550, "tipo": "SE" },
            "25103": { "nombre": "MARIANA BERENICE LOJERO DE LA ROSA", "colegiatura": 2750, "tipo": "SE" },
            "25301": { "nombre": "MIA PACHECO MARINES", "colegiatura": 2750, "tipo": "SE" },
            "25304": { "nombre": "FATIMA IXCHEL DE LEON CARRANZA", "colegiatura": 2600, "tipo": "ST" },
            // Nota: En el bot real se cargan todas las 134 matrÃ­culas desde auth-alumnos.js
        };

        // Elementos del DOM
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const editModeToggle = document.getElementById('editModeToggle');

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            messageInput.addEventListener('keypress', handleKeyPress);
            messageInput.addEventListener('input', autoResize);
            sendButton.addEventListener('click', sendMessage);
            
            // Mostrar mensaje inicial
            setTimeout(() => {
                showMainMenu();
            }, 1000);
            
            updateSidebarInfo();
        });

        // Funciones principales
        function handleKeyPress(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        function autoResize() {
            messageInput.style.height = 'auto';
            messageInput.style.height = messageInput.scrollHeight + 'px';
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            addUserMessage(message);
            messageInput.value = '';
            autoResize();

            processUserInput(message);
        }

        function processUserInput(input) {
            const normalizedInput = input.toLowerCase().trim();
            
            // Si estamos en estado salir, CUALQUIER input regresa al menÃº
            if (botState.currentState === 'salir') {
                showMainMenu();
                return;
            }
            
            // Resetear conversaciÃ³n con "hola"
            if (normalizedInput === 'hola' || normalizedInput === 'hello') {
                showMainMenu();
                return;
            }
            
            // Manejo especial para sistema de alumnos
            if (botState.currentState === 'esperando_matricula') {
                handleMatriculaInput(input);
                return;
            }
            
            // Verificar respuestas del mapa
            const currentResponses = responseMap[botState.currentState];
            if (currentResponses && currentResponses[input]) {
                // Actualizar navegaciÃ³n
                if (input !== '0' && /^\d+$/.test(input)) {
                    botState.navigationPath.push(input);
                } else if (input === '0') {
                    botState.navigationPath.pop();
                }
                
                goToState(currentResponses[input]);
                return;
            }

            // Si no hay coincidencia, mostrar error
            showErrorMessage();
        }

        function goToState(stateName) {
            const state = flowData.find(f => f.state === stateName);
            if (state) {
                // Debug: verificar el mensaje completo
                console.log('Estado:', stateName);
                console.log('Longitud del mensaje:', state.message.length);
                console.log('Mensaje completo:', state.message);
                console.log('Ãšltima parte del mensaje:', state.message.slice(-100));
                
                addBotMessage(state.message, state.state);
                botState.currentState = stateName;
                updateSidebarInfo();
                updateNavigationDisplay();
            }
        }

        function showMainMenu() {
            botState.navigationPath = [];
            goToState('inicio');
        }

        function addUserMessage(text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.innerHTML = `
                ${formatMessage(text)}
                <div class="message-time">${getCurrentTime()}</div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        function addBotMessage(text, state = null, delay = 1500) {
            showTyping();
            
            setTimeout(() => {
                hideTyping();
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message bot';
                if (botState.editMode) {
                    messageDiv.classList.add('editable');
                    messageDiv.onclick = () => editMessage(messageDiv, state);
                }
                
                const editedText = botState.editedStates.get(state) || text;
                
                // Asegurar que el mensaje se renderiza completo
                const formattedMessage = formatMessage(editedText);
                
                messageDiv.innerHTML = `
                    <div class="message-content">${formattedMessage}</div>
                    <div class="message-time">${getCurrentTime()}</div>
                    ${state && botState.editMode ? `<div class="state-info">Estado: ${state}</div>` : ''}
                `;
                messageDiv.dataset.state = state;
                messageDiv.dataset.originalText = text;
                messagesContainer.appendChild(messageDiv);
                scrollToBottom();
            }, delay);
        }

        function editMessage(messageDiv, state) {
            if (!botState.editMode || messageDiv.classList.contains('editing')) return;
            
            messageDiv.classList.add('editing');
            const currentText = messageDiv.dataset.originalText || messageDiv.innerText;
            
            // Guardar el ancho original
            const originalWidth = messageDiv.offsetWidth;
            
            messageDiv.innerHTML = `
                <textarea class="message-edit-area" style="width: ${originalWidth}px;">${currentText}</textarea>
                <div class="edit-controls">
                    <button class="save-button" onclick="saveEdit('${state}', this)">Guardar</button>
                    <button class="cancel-button" onclick="cancelEdit(this)">Cancelar</button>
                </div>
            `;
            
            const textarea = messageDiv.querySelector('.message-edit-area');
            textarea.focus();
            // Calcular altura basada en contenido
            const lineHeight = 20;
            const lines = currentText.split('\n').length;
            textarea.style.height = Math.max(150, lines * lineHeight + 40) + 'px';
            autoResizeTextarea(textarea);
            textarea.addEventListener('input', () => autoResizeTextarea(textarea));
        }

        function saveEdit(state, button) {
            const messageDiv = button.closest('.message');
            const textarea = messageDiv.querySelector('.message-edit-area');
            const newText = textarea.value.trim();
            
            if (newText) {
                // Guardar el cambio
                botState.editedStates.set(state, newText);
                
                // Actualizar el flowData
                const stateData = flowData.find(f => f.state === state);
                if (stateData) {
                    stateData.message = newText;
                }
                
                // Actualizar la vista
                messageDiv.classList.remove('editing');
                messageDiv.innerHTML = `
                    ${formatMessage(newText)}
                    <div class="message-time">${getCurrentTime()}</div>
                    ${botState.editMode ? `<div class="state-info">Estado: ${state}</div>` : ''}
                `;
                messageDiv.dataset.originalText = newText;
                
                showToast('Cambio guardado');
            }
        }

        function cancelEdit(button) {
            const messageDiv = button.closest('.message');
            const state = messageDiv.dataset.state;
            const originalText = botState.editedStates.get(state) || messageDiv.dataset.originalText;
            
            messageDiv.classList.remove('editing');
            messageDiv.innerHTML = `
                ${formatMessage(originalText)}
                <div class="message-time">${getCurrentTime()}</div>
                ${state && botState.editMode ? `<div class="state-info">Estado: ${state}</div>` : ''}
            `;
        }

        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        function toggleEditMode() {
            botState.editMode = !botState.editMode;
            editModeToggle.classList.toggle('active');
            editModeToggle.textContent = botState.editMode ? 'ğŸ’¾ Guardar' : 'âœï¸ Editar';
            
            // Actualizar mensajes existentes
            const messages = document.querySelectorAll('.message.bot');
            messages.forEach(msg => {
                if (botState.editMode) {
                    msg.classList.add('editable');
                    const state = msg.dataset.state;
                    if (state) {
                        msg.onclick = () => editMessage(msg, state);
                    }
                } else {
                    msg.classList.remove('editable');
                    msg.onclick = null;
                }
            });
            
            updateSidebarInfo();
            showToast(botState.editMode ? 'Modo ediciÃ³n activado' : 'Modo ediciÃ³n desactivado');
        }

        function exportChanges() {
            const exportData = {
                timestamp: new Date().toISOString(),
                editedStates: Array.from(botState.editedStates.entries()),
                flowData: flowData.filter(state => 
                    botState.editedStates.has(state.state)
                ).map(state => ({
                    state: state.state,
                    message: state.message,
                    options: state.options
                }))
            };
            
            const exportText = `// CAMBIOS EXPORTADOS - ${new Date().toLocaleString()}
// Copia este cÃ³digo y envÃ­alo a Claude para actualizar el bot

const cambiosExportados = ${JSON.stringify(exportData, null, 2)};

// Estados modificados: ${exportData.editedStates.length}
${exportData.editedStates.map(([state, message]) => 
    `// - ${state}`
).join('\n')}`;
            
            document.getElementById('exportData').value = exportText;
            document.getElementById('exportModal').style.display = 'block';
        }

        function importChanges() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,.txt';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const content = e.target.result;
                        // Extraer el JSON del contenido
                        const jsonMatch = content.match(/const cambiosExportados = ({[\s\S]*?});/);
                        if (jsonMatch) {
                            const data = JSON.parse(jsonMatch[1]);
                            
                            // Aplicar cambios
                            data.editedStates.forEach(([state, message]) => {
                                botState.editedStates.set(state, message);
                                const stateData = flowData.find(f => f.state === state);
                                if (stateData) {
                                    stateData.message = message;
                                }
                            });
                            
                            showToast(`${data.editedStates.length} cambios importados`);
                            
                            // Recargar la conversaciÃ³n actual
                            messagesContainer.innerHTML = '';
                            goToState(botState.currentState);
                        }
                    } catch (error) {
                        showToast('Error al importar cambios');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function copyToClipboard() {
            const textarea = document.getElementById('exportData');
            textarea.select();
            document.execCommand('copy');
            showToast('Copiado al portapapeles');
        }

        function closeModal() {
            document.getElementById('exportModal').style.display = 'none';
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function handleMatriculaInput(matricula) {
            const alumno = studentsDB[matricula];
            if (alumno) {
                botState.sessionData = botState.sessionData || {};
                botState.sessionData.studentData = alumno;
                botState.sessionData.matricula = matricula;
                
                // Determinar tipo de curso
                let tipoTexto = '';
                switch(alumno.tipo) {
                    case 'SE': tipoTexto = 'Semanal'; break;
                    case 'SA': tipoTexto = 'Sabatino'; break;
                    case 'ST': tipoTexto = 'Sabatino'; break;
                    case 'KI': tipoTexto = 'Kids'; break;
                    default: tipoTexto = alumno.tipo;
                }
                
                addBotMessage(`ğŸ“ *Â¡Hola ${alumno.nombre}!*

âœ… MatrÃ­cula: ${matricula}
ğŸ’µ Colegiatura: $${alumno.colegiatura.toLocaleString()}.00
ğŸ“š Curso: ${tipoTexto}

Ahora puedes acceder a todos los servicios para alumnos.`);
                
                // Ir directamente al menÃº de alumno sin PIN
                setTimeout(() => {
                    goToState('menu_alumno');
                }, 1500);
            } else {
                addBotMessage(`âŒ MatrÃ­cula no encontrada en nuestro sistema.

Por favor verifica que sea correcta o contacta a recepciÃ³n:
ğŸ“ 341 414 1215

TambiÃ©n puedes solicitar informaciÃ³n como nuevo interesado usando la opciÃ³n 1 del menÃº principal.

Escribe "salir" para volver al menÃº principal.`);
            }
        }


        function showErrorMessage() {
            addBotMessage(`âŒ No entendÃ­ tu mensaje. Por favor selecciona una opciÃ³n vÃ¡lida o escribe "hola" para volver al menÃº principal.`);
        }

        function formatMessage(text) {
            // Primero escapar HTML para prevenir XSS
            const escapeHtml = (str) => {
                const div = document.createElement('div');
                div.textContent = str;
                return div.innerHTML;
            };
            
            // Escapar el texto pero preservar los saltos de lÃ­nea
            let safeText = text.split('\n').map(line => escapeHtml(line)).join('\n');
            
            // Ahora aplicar formato de manera segura
            return safeText
                .replace(/\*([^*]+)\*/g, '<strong>$1</strong>')
                .replace(/_([^_]+)_/g, '<em>$1</em>')
                .replace(/\n/g, '<br>');
        }

        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('es-MX', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        function showTyping() {
            typingIndicator.classList.add('show');
        }

        function hideTyping() {
            typingIndicator.classList.remove('show');
        }

        function scrollToBottom() {
            setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                // Asegurar que el Ãºltimo mensaje sea visible
                const lastMessage = messagesContainer.lastElementChild;
                if (lastMessage) {
                    lastMessage.scrollIntoView({ behavior: 'smooth', block: 'end' });
                }
            }, 100);
        }

        function updateSidebarInfo() {
            document.getElementById('sidebarState').textContent = botState.currentState;
            document.getElementById('sidebarNav').textContent = botState.navigationPath.join("'") || '-';
            document.getElementById('editModeStatus').textContent = botState.editMode ? 'EdiciÃ³n' : 'VisualizaciÃ³n';
        }

        function updateNavigationDisplay() {
            const navState = document.getElementById('navigationState');
            const currentRoute = document.getElementById('currentRoute');
            
            if (botState.navigationPath.length > 0) {
                navState.classList.add('active');
                currentRoute.textContent = botState.navigationPath.join("'");
            } else {
                navState.classList.remove('active');
                currentRoute.textContent = 'inicio';
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('mobile-show');
        }

        function quickAccess(state) {
            botState.navigationPath = [];
            goToState(state);
            
            // Cerrar sidebar en mÃ³vil
            if (window.innerWidth <= 430) {
                document.getElementById('sidebar').classList.remove('mobile-show');
            }
        }

        // Cerrar modal al hacer clic fuera
        window.onclick = function(event) {
            const modal = document.getElementById('exportModal');
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
