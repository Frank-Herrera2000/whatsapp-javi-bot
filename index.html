<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Universal House - Simulador WhatsApp Bot MEJORADO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: #0a1014;
            height: 100vh;
            overflow: hidden;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .whatsapp-container {
            display: flex;
            height: 100vh;
            background: #111b21;
            position: relative;
        }

        /* Panel izquierdo - Lista de chats */
        .sidebar {
            width: 30%;
            min-width: 340px;
            background: #111b21;
            border-right: 1px solid #2a3942;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        /* Estilos móviles para iPhone 15 Pro Max */
        @media screen and (max-width: 430px) {
            .sidebar {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                min-width: unset;
                height: 100%;
                z-index: 10;
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-chat {
                width: 100% !important;
            }

            .mobile-menu-btn {
                display: block !important;
                position: absolute;
                left: 10px;
                top: 50%;
                transform: translateY(-50%);
                background: none;
                border: none;
                color: #e9edef;
                font-size: 24px;
                padding: 8px;
                cursor: pointer;
                z-index: 1;
            }

            .chat-header {
                padding-left: 50px;
            }

            .messages-container {
                padding: 10px 15px !important;
            }

            .message-content {
                max-width: 85% !important;
            }

            .admin-toggle {
                bottom: 80px !important;
                right: 10px !important;
                padding: 8px 15px !important;
                font-size: 12px !important;
            }
        }

        .mobile-menu-btn {
            display: none;
        }

        .sidebar-header {
            background: #202c33;
            padding: 10px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 60px;
        }

        .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #6b7c85;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #111b21;
            font-weight: bold;
        }

        .sidebar-icons {
            display: flex;
            gap: 24px;
        }

        .icon-btn {
            width: 24px;
            height: 24px;
            cursor: pointer;
            color: #aebac1;
            background: none;
            border: none;
            transition: color 0.2s;
        }

        .icon-btn:hover {
            color: #d1d7db;
        }

        .search-container {
            background: #111b21;
            padding: 8px 12px;
            border-bottom: 1px solid #2a3942;
        }

        .search-bar {
            background: #202c33;
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding: 0 12px;
            height: 36px;
        }

        .search-bar input {
            flex: 1;
            background: none;
            border: none;
            outline: none;
            color: #e9edef;
            font-size: 14px;
            margin-left: 24px;
        }

        .search-bar input::placeholder {
            color: #8696a0;
        }

        .chats-list {
            flex: 1;
            overflow-y: auto;
            background: #111b21;
        }

        .chat-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid #202c33;
        }

        .chat-item:hover {
            background: #202c33;
        }

        .chat-item.active {
            background: #2a3942;
        }

        .chat-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #00a884;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 20px;
        }

        .chat-info {
            flex: 1;
            overflow: hidden;
        }

        .chat-name {
            color: #e9edef;
            font-size: 16px;
            font-weight: 400;
            margin-bottom: 2px;
        }

        .chat-message {
            color: #8696a0;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }

        .chat-time {
            color: #8696a0;
            font-size: 12px;
        }

        .unread-badge {
            background: #00a884;
            color: #111b21;
            font-size: 12px;
            font-weight: 600;
            border-radius: 10px;
            padding: 2px 6px;
            min-width: 20px;
            text-align: center;
        }

        /* Panel derecho - Conversación */
        .main-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #0b141a;
            position: relative;
        }

        .chat-header {
            background: #202c33;
            padding: 10px 16px;
            display: flex;
            align-items: center;
            height: 60px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            position: relative;
        }

        .chat-header-info {
            flex: 1;
            margin-left: 12px;
        }

        .chat-header-name {
            color: #e9edef;
            font-size: 16px;
            font-weight: 400;
        }

        .chat-header-status {
            color: #8696a0;
            font-size: 13px;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 60px;
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAARklEQVQYV2NkYGD4z0ABYBw1kL6WMjIyMpADRg2kv4WjBo4aOGrgqIGjBo4aOGrgqIGjBo4aOGrgqIGjBo4aOGrgqIEDZyAAWgAKCnYG3qgAAAAASUVORK5CYII=');
            background-repeat: repeat;
            position: relative;
        }

        .message {
            display: flex;
            margin-bottom: 12px;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.sent {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 65%;
            padding: 8px 12px;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }

        .message.received .message-content {
            background: #202c33;
            color: #e9edef;
            border-top-left-radius: 0;
        }

        .message.sent .message-content {
            background: #005c4b;
            color: #e9edef;
            border-top-right-radius: 0;
        }

        .message-text {
            font-size: 14.5px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .message-time {
            font-size: 11px;
            color: #8696a0;
            margin-top: 4px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 2px;
        }

        .message.sent .message-time {
            color: #81a89d;
        }

        .check-marks {
            width: 16px;
            height: 11px;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            background: #202c33;
            border-radius: 8px;
            max-width: 80px;
            margin-bottom: 12px;
        }

        .typing-indicator.show {
            display: flex;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #8696a0;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: scale(0.8);
            }
            30% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .input-container {
            background: #202c33;
            padding: 10px 16px;
            display: flex;
            align-items: flex-end;
            gap: 8px;
            min-height: 62px;
        }

        .input-wrapper {
            flex: 1;
            background: #2a3942;
            border-radius: 8px;
            display: flex;
            align-items: flex-end;
            padding: 5px 12px;
        }

        .message-input {
            flex: 1;
            background: none;
            border: none;
            outline: none;
            color: #e9edef;
            font-size: 15px;
            line-height: 20px;
            max-height: 100px;
            resize: none;
            padding: 8px 0;
            font-family: inherit;
            -webkit-appearance: none;
        }

        .message-input::placeholder {
            color: #8696a0;
        }

        .send-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #00a884;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
            color: #111b21;
        }

        .send-button:hover {
            background: #00c897;
        }

        .send-button:active {
            transform: scale(0.95);
        }

        /* Scrollbar personalizado */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #374045;
            border-radius: 3px;
        }

        /* Estados del sistema */
        .system-message {
            text-align: center;
            margin: 20px 0;
        }

        .system-message span {
            background: #182229;
            color: #8696a0;
            font-size: 12px;
            padding: 5px 12px;
            border-radius: 8px;
            display: inline-block;
        }

        /* Notificación de nuevo mensaje */
        .new-message-alert {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: #202c33;
            color: #e9edef;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            display: none;
            animation: slideUp 0.3s ease-out;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translate(-50%, 20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        /* Admin panel toggle */
        .admin-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #202c33;
            color: #e9edef;
            border: 1px solid #374045;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            z-index: 1000;
            transition: all 0.2s;
        }

        .admin-toggle:hover {
            background: #2a3942;
            transform: translateY(-2px);
        }

        /* Error message styles */
        .error-message {
            background: #dc2626 !important;
            color: #fee2e2 !important;
        }

        .suggestion-message {
            background: #1f2937 !important;
            color: #9ca3af !important;
            border-left: 4px solid #3b82f6;
            padding-left: 16px !important;
        }

        /* Quick reply buttons */
        .quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .quick-reply-btn {
            background: #2a3942;
            color: #e9edef;
            border: 1px solid #374045;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .quick-reply-btn:hover {
            background: #374045;
            transform: translateY(-1px);
        }

        /* Debug panel */
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: #00ff00;
            padding: 10px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            display: none;
            z-index: 10000;
        }

        .debug-panel.show {
            display: block;
        }
        
        /* Estilos para edición de mensajes */
        .message-text {
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .message-text:hover {
            background: rgba(255,255,255,0.05);
            outline: 1px dashed rgba(255,255,255,0.3);
        }
        
        .message-text.editing {
            background: rgba(0,168,132,0.1);
            outline: 2px solid #00a884;
            padding: 12px;
            cursor: text;
            -webkit-user-select: text;
            user-select: text;
        }
        
        /* Botón de exportar */
        .export-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #00a884;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 1000;
            transition: all 0.3s;
        }
        
        .export-btn:hover {
            background: #00c897;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }
        
        /* Modo edición toggle */
        .edit-mode-toggle {
            position: fixed;
            top: 70px;
            right: 20px;
            background: #202c33;
            color: #e9edef;
            border: 1px solid #374045;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            z-index: 1000;
        }
        
        .edit-mode-toggle.active {
            background: #00a884;
            color: #111b21;
            border-color: #00a884;
        }
    </style>
</head>
<body>
    <div class="whatsapp-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="profile-pic">UH</div>
                <div class="sidebar-icons">
                    <button class="icon-btn">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 20.664a9.163 9.163 0 0 1-6.521-2.702.977.977 0 0 1 1.381-1.381 7.269 7.269 0 0 0 10.280 0 .977.977 0 0 1 1.381 1.381A9.163 9.163 0 0 1 12 20.664zM6.965 14.096a.977.977 0 0 1-.977-.977v-2.31a.977.977 0 0 1 1.954 0v2.31a.977.977 0 0 1-.977.977zm10.07 0a.977.977 0 0 1-.977-.977v-2.31a.977.977 0 0 1 1.954 0v2.31a.977.977 0 0 1-.977.977z"/></svg>
                    </button>
                    <button class="icon-btn">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.005 3.175H4.674C3.642 3.175 3 3.789 3 4.821v1.792c0 1.097.642 1.648 1.674 1.648h15.331c1.032 0 1.674-.551 1.674-1.648V4.821c0-1.032-.642-1.646-1.674-1.646zM8.006 18.342a.977.977 0 0 1-.977-.977v-7.456a.977.977 0 0 1 1.954 0v7.456a.977.977 0 0 1-.977.977zm8 0a.977.977 0 0 1-.977-.977v-7.456a.977.977 0 0 1 1.954 0v7.456a.977.977 0 0 1-.977.977z"/></svg>
                    </button>
                    <button class="icon-btn">
                        <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
                    </button>
                </div>
            </div>
            
            <div class="search-container">
                <div class="search-bar">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="#8696a0">
                        <path d="M15.009 13.805h-.636l-.22-.217a5.184 5.184 0 0 0 1.256-3.386 5.207 5.207 0 1 0-5.207 5.208 5.183 5.183 0 0 0 3.385-1.255l.217.22v.635l4.004 3.999 1.194-1.195-3.993-4.009zm-4.808 0a3.605 3.605 0 1 1 0-7.21 3.605 3.605 0 0 1 0 7.21z"/>
                    </svg>
                    <input type="text" placeholder="Buscar o empezar un chat nuevo">
                </div>
            </div>
            
            <div class="chats-list">
                <div class="chat-item active">
                    <div class="chat-avatar">🤖</div>
                    <div class="chat-info">
                        <div class="chat-name">Universal House Bot</div>
                        <div class="chat-message">Hola! Bienvenido a Universal House</div>
                    </div>
                    <div class="chat-meta">
                        <div class="chat-time">ahora</div>
                        <div class="unread-badge">1</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Chat -->
        <div class="main-chat">
            <div class="chat-header">
                <button class="mobile-menu-btn" onclick="toggleSidebar()">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </button>
                <div class="chat-avatar">🤖</div>
                <div class="chat-header-info">
                    <div class="chat-header-name">Universal House Bot</div>
                    <div class="chat-header-status">en línea</div>
                </div>
                <div class="sidebar-icons">
                    <button class="icon-btn" onclick="toggleDebug()">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20,8H17.19C16.74,7.22 16.12,6.55 15.37,6.04L17,4.41L15.59,3L13.42,5.17C12.96,5.06 12.49,5 12,5C11.51,5 11.04,5.06 10.59,5.17L8.41,3L7,4.41L8.62,6.04C7.88,6.55 7.26,7.22 6.81,8H4V10H6.09C6.04,10.33 6,10.66 6,11V12H4V14H6V15C6,15.34 6.04,15.67 6.09,16H4V18H6.81C7.85,19.79 9.78,21 12,21C14.22,21 16.15,19.79 17.19,18H20V16H17.91C17.96,15.67 18,15.34 18,15V14H20V12H18V11C18,10.66 17.96,10.33 17.91,10H20V8Z"/></svg>
                    </button>
                    <button class="icon-btn">
                        <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
                    </button>
                </div>
            </div>

            <div class="messages-container" id="messagesContainer">
                <div class="system-message">
                    <span>Los mensajes están cifrados de extremo a extremo</span>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>

            <div class="new-message-alert" id="newMessageAlert">
                ↓ Nuevo mensaje
            </div>

            <div class="input-container">
                <button class="icon-btn">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M9.153 11.603c.795 0 1.439-.879 1.439-1.962s-.644-1.962-1.439-1.962-1.439.879-1.439 1.962.644 1.962 1.439 1.962zm-3.204 1.362c-.026-.307-.131 5.218 6.063 5.551 6.066-.25 6.066-5.551 6.066-5.551-6.078 1.416-12.129 0-12.129 0zm11.363 1.108s-.669 1.959-5.051 1.959c-3.505 0-5.388-1.164-5.607-1.959 0 0 5.912 1.055 10.658 0zM11.804 1.011C5.609 1.011.978 6.033.978 12.228s4.826 10.761 11.021 10.761S23.02 18.423 23.02 12.228c.001-6.195-5.021-11.217-11.216-11.217zM12 21.354c-5.273 0-9.381-3.886-9.381-9.159s3.942-9.548 9.215-9.548 9.548 4.275 9.548 9.548c-.001 5.272-4.109 9.159-9.382 9.159zm3.108-9.751c.795 0 1.439-.879 1.439-1.962s-.644-1.962-1.439-1.962-1.439.879-1.439 1.962.644 1.962 1.439 1.962z"/></svg>
                </button>
                <div class="input-wrapper">
                    <textarea 
                        class="message-input" 
                        id="messageInput"
                        placeholder="Escribe un mensaje"
                        rows="1"
                    ></textarea>
                </div>
                <button class="send-button" id="sendButton">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                        <path d="M1.101 21.757L23.8 12.028 1.101 2.3l.011 7.912 13.623 1.816-13.623 1.817-.011 7.912z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Debug Panel -->
    <div class="debug-panel" id="debugPanel">
        <div>Estado actual: <span id="currentState">iniciando</span></div>
        <div>Último input: <span id="lastInput">-</span></div>
        <div>Errores: <span id="errorCount">0</span></div>
    </div>

    <!-- Admin Panel -->
    <button class="admin-toggle" onclick="toggleAdminPanel()">
        Debug Panel
    </button>
    
    <!-- Botón de Modo Edición -->
    <button class="edit-mode-toggle" id="editModeToggle" onclick="toggleEditMode()">
        ✏️ Modo Edición: OFF
    </button>
    
    <!-- Botón de Exportar -->
    <button class="export-btn" onclick="exportarChat()">
        📤 Exportar Chat
    </button>

    <script>
        // Estado del bot MEJORADO
        const botState = {
            currentState: 'menu_principal',
            userName: '',
            userPhone: '',
            conversationHistory: [],
            currentFlow: null,
            editingIndex: null,
            errorCount: 0,
            lastInput: '',
            debugMode: false
        };

        // Flujo simplificado y mejorado
        const flowData = [
            {
                id: 1,
                title: "Menú Principal",
                state: "menu_principal",
                content: `🏫 *Universal House - Escuela de Inglés*

🤖 ¡Hola! Soy Javi, tu asistente virtual. Es un gusto atenderte.

Selecciona una opción escribiendo el número:

*1* 🌐 Información de cursos
*2* 👨‍🎓 Soy alumno de Universal House
*3* 🔐 Acceso administrativo

💡 También puedes escribir:
• "precios" para ver costos
• "horarios" para ver horarios
• "ubicación" para ver dónde estamos

¿En qué puedo ayudarte?`
            },
            {
                id: 2,
                title: "Información de Cursos",
                state: "menu_informacion",
                content: `📚 *INFORMACIÓN DE CURSOS*

¿Qué información necesitas?

*1* 💰 Precios y costos
*2* 🕒 Horarios de clase
*3* 📝 Examen de ubicación
*4* ✍️ Proceso de inscripción
*5* 🗓️ Inicio de cursos
*6* 🎖️ Niveles que manejamos
*7* 📜 Certificaciones
*8* 📍 Ubicación y contacto
*9* 🪪 Métodos de pago
*0* ⬅️ Volver al menú principal

Escribe el número de tu opción:`
            },
            {
                id: 3,
                title: "Precios y Costos",
                state: "info_precios",
                content: `💰 *PRECIOS DE NUESTROS CURSOS*

🔸 *CURSO DOMINIO (11+ años)*
• Semanal: $1,300/mes (4 hrs/semana)
• Sabatino: $1,200 cada 4 semanas (3 hrs)

🔸 *CURSO KIDS (7-10 años)*
• $1,100/mes (4 hrs/semana)
• Martes y jueves 17:00-19:00

🔸 *MASTERY B2/C1*
• B2: $1,600/mes (4 hrs/semana)
• C1: $1,500 cada 4 semanas

📋 *COSTOS ADICIONALES*
• Inscripción: $280
• Material (18 meses): $1,700

🎁 *BENEFICIO ESPECIAL*
Clases presenciales + acceso virtual incluido

*1* Ver horarios disponibles
*2* Proceso de inscripción
*0* Volver al menú anterior`
            },
            {
                id: 4,
                title: "Horarios Disponibles",
                state: "info_horarios",
                content: `🕒 *HORARIOS DISPONIBLES*

📅 *CLASES SEMANALES*
• 17:00 - 18:00 hrs
• 18:00 - 19:00 hrs  
• 19:00 - 20:00 hrs
(Lunes a Jueves)

📅 *CLASES SABATINAS*
• 08:00 - 11:00 hrs
• 11:00 - 14:00 hrs

👶 *KIDS*
• Martes y Jueves 17:00 - 19:00 hrs

*Tu horario final depende de tu nivel actual*

*1* Hacer examen de ubicación
*2* Ver precios
*0* Volver al menú anterior`
            },
            {
                id: 5,
                title: "Examen de Ubicación",
                state: "info_examen",
                content: `📝 *EXAMEN DE UBICACIÓN*

💵 *Costo:* $280 pesos

📅 *Fechas disponibles:*
• Lunes y Miércoles 19:00 hrs
• Sábados 11:00 hrs

📍 *Ubicación:*
Francisco I. Madero 1408, Centro
(A espaldas de presidencia, Portal Morelos Local 14)

⏰ *Importante:*
• Llega 15 minutos antes
• Trae comprobante de pago
• No necesitas agendar

*1* Ver métodos de pago
*2* Ver ubicación en mapa
*0* Volver al menú anterior`
            },
            {
                id: 6,
                title: "Portal de Alumnos",
                state: "portal_alumnos",
                content: `👨‍🎓 *PORTAL DE ALUMNOS*

Ingresa tu matrícula (8 dígitos):
Ejemplo: 12345678

O selecciona una opción:

*1* 📋 Consultar calificaciones
*2* 📅 Mi horario de clases  
*3* 💳 Pagar mensualidad
*4* 📧 Solicitar constancia
*5* 📱 Actualizar datos
*6* 🔔 Reportar inasistencia
*7* 📚 Plataforma digital
*8* 👩‍🏫 Contactar profesor
*0* ⬅️ Volver al menú principal`
            },
            {
                id: 7,
                title: "Ubicación y Contacto",
                state: "info_ubicacion",
                content: `📍 *UBICACIÓN Y CONTACTO*

🏫 *Dirección:*
Francisco I. Madero 1408
Col. Centro, Cd. Guzmán, Jalisco
(Portal Morelos, Planta Alta, Local 14)

📞 *Teléfono:*
341 414 1215

🕒 *Horarios de Atención:*
• Lunes a Viernes: 11:00-14:00 y 16:00-20:00
• Sábados: 9:00-14:00

📧 *Email:*
info@universalhouse.edu.mx

🗺️ *Referencias:*
A espaldas de la presidencia municipal

*1* Ver horarios de clase
*2* Agendar cita
*0* Volver al menú anterior`
            }
        ];

        // Mapeo SIMPLIFICADO de respuestas
        const responseMap = {
            'menu_principal': {
                '1': 'menu_informacion',
                '2': 'portal_alumnos', 
                '3': 'admin_access',
                'precios': 'info_precios',
                'horarios': 'info_horarios',
                'ubicacion': 'info_ubicacion',
                'ubicación': 'info_ubicacion'
            },
            'menu_informacion': {
                '1': 'info_precios',
                '2': 'info_horarios',
                '3': 'info_examen',
                '4': 'info_inscripcion',
                '5': 'info_inicio_cursos',
                '6': 'info_niveles',
                '7': 'info_certificaciones',
                '8': 'info_ubicacion',
                '9': 'info_metodos_pago',
                '0': 'menu_principal'
            },
            'info_precios': {
                '1': 'info_horarios',
                '2': 'info_inscripcion',
                '0': 'menu_informacion'
            },
            'info_horarios': {
                '1': 'info_examen',
                '2': 'info_precios',
                '0': 'menu_informacion'
            },
            'info_examen': {
                '1': 'info_metodos_pago',
                '2': 'info_ubicacion',
                '0': 'menu_informacion'
            },
            'portal_alumnos': {
                '1': 'consultar_calificaciones',
                '2': 'ver_horario',
                '3': 'pago_mensualidad',
                '4': 'solicitar_constancia',
                '5': 'actualizar_datos',
                '6': 'reportar_inasistencia',
                '7': 'plataforma_digital',
                '8': 'contactar_profesor',
                '0': 'menu_principal'
            },
            'info_ubicacion': {
                '1': 'info_horarios',
                '2': 'agendar_cita',
                '0': 'menu_informacion'
            }
        };

        // Palabras clave para inteligencia artificial
        const keywordResponses = {
            // Saludos
            'hola': () => showMainMenu(),
            'hi': () => showMainMenu(),
            'buenos': () => showMainMenu(),
            'buenas': () => showMainMenu(),
            
            // Precios
            'precio': () => goToState('info_precios'),
            'costo': () => goToState('info_precios'),
            'cuanto': () => goToState('info_precios'),
            'cuánto': () => goToState('info_precios'),
            
            // Horarios
            'horario': () => goToState('info_horarios'),
            'cuando': () => goToState('info_horarios'),
            'cuándo': () => goToState('info_horarios'),
            'tiempo': () => goToState('info_horarios'),
            
            // Ubicación
            'donde': () => goToState('info_ubicacion'),
            'dónde': () => goToState('info_ubicacion'),
            'ubicacion': () => goToState('info_ubicacion'),
            'ubicación': () => goToState('info_ubicacion'),
            'direccion': () => goToState('info_ubicacion'),
            'dirección': () => goToState('info_ubicacion'),
            
            // Examen
            'examen': () => goToState('info_examen'),
            'test': () => goToState('info_examen'),
            'evaluacion': () => goToState('info_examen'),
            'evaluación': () => goToState('info_examen'),
            
            // Cursos
            'curso': () => goToState('menu_informacion'),
            'clases': () => goToState('menu_informacion'),
            'ingles': () => goToState('menu_informacion'),
            'inglés': () => goToState('menu_informacion'),
            
            // Despedidas
            'gracias': () => showGoodbye(),
            'adios': () => showGoodbye(),
            'adiós': () => showGoodbye(),
            'bye': () => showGoodbye(),
            'hasta': () => showGoodbye(),
            
            // Reset
            'menu': () => showMainMenu(),
            'inicio': () => showMainMenu(),
            'principal': () => showMainMenu(),
            'reset': () => showMainMenu(),
            
            // Ayuda
            'ayuda': () => showHelp(),
            'help': () => showHelp(),
            '?': () => showHelp()
        };

        // Elementos del DOM
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const debugPanel = document.getElementById('debugPanel');
        const sidebar = document.getElementById('sidebar');

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            messageInput.addEventListener('keypress', handleKeyPress);
            messageInput.addEventListener('input', autoResize);
            sendButton.addEventListener('click', sendMessage);
            
            // Mensaje inicial del bot
            setTimeout(() => {
                showMainMenu();
            }, 1000);

            // Cerrar sidebar en móvil al hacer clic fuera
            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 430) {
                    if (!sidebar.contains(e.target) && !e.target.closest('.mobile-menu-btn')) {
                        sidebar.classList.remove('show');
                    }
                }
            });

            updateDebugPanel();
        });

        // Toggle sidebar móvil
        function toggleSidebar() {
            sidebar.classList.toggle('show');
        }

        // Toggle debug panel
        function toggleDebug() {
            botState.debugMode = !botState.debugMode;
            debugPanel.classList.toggle('show');
            updateDebugPanel();
        }

        // Actualizar panel de debug
        function updateDebugPanel() {
            if (botState.debugMode) {
                document.getElementById('currentState').textContent = botState.currentState;
                document.getElementById('lastInput').textContent = botState.lastInput || '-';
                document.getElementById('errorCount').textContent = botState.errorCount;
            }
        }

        // Auto-resize del textarea
        function autoResize() {
            messageInput.style.height = 'auto';
            messageInput.style.height = messageInput.scrollHeight + 'px';
        }

        // Manejar Enter
        function handleKeyPress(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        // Enviar mensaje MEJORADO
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // Guardar input para debug
            botState.lastInput = message;
            updateDebugPanel();

            // Agregar mensaje del usuario
            addUserMessage(message);
            
            // Limpiar input
            messageInput.value = '';
            autoResize();

            // Procesar respuesta del bot
            processUserInput(message);
        }

        // Procesar input INTELIGENTE
        function processUserInput(input) {
            const normalizedInput = input.toLowerCase().trim();
            
            try {
                // 1. Verificar si es un número válido para el estado actual
                const currentStateData = responseMap[botState.currentState];
                if (currentStateData && currentStateData[normalizedInput]) {
                    const nextState = currentStateData[normalizedInput];
                    goToState(nextState);
                    return;
                }

                // 2. Verificar palabras clave
                for (const [keyword, action] of Object.entries(keywordResponses)) {
                    if (normalizedInput.includes(keyword)) {
                        action();
                        return;
                    }
                }

                // 3. Verificar si es matrícula (8 dígitos)
                if (/^\d{8}$/.test(normalizedInput) && botState.currentState === 'portal_alumnos') {
                    handleStudentLogin(normalizedInput);
                    return;
                }

                // 4. Verificar números válidos pero fuera de rango
                if (/^\d+$/.test(normalizedInput)) {
                    showInvalidOptionError(normalizedInput);
                    return;
                }

                // 5. Respuesta inteligente basada en contexto
                handleIntelligentResponse(input);

            } catch (error) {
                botState.errorCount++;
                updateDebugPanel();
                showErrorMessage("Ocurrió un error inesperado. Intenta nuevamente o escribe 'menu' para volver al inicio.");
            }
        }

        // Ir a un estado específico
        function goToState(stateName) {
            const flow = flowData.find(f => f.state === stateName);
            if (flow) {
                addBotMessage(flow.content);
                botState.currentState = stateName;
                updateDebugPanel();
            } else {
                showErrorMessage(`Estado '${stateName}' no encontrado. Volviendo al menú principal.`);
                showMainMenu();
            }
        }

        // Mostrar menú principal
        function showMainMenu() {
            goToState('menu_principal');
        }

        // Mostrar despedida
        function showGoodbye() {
            addBotMessage(`🌟 *¡Gracias por contactar Universal House!*

Fue un placer atenderte. Si necesitas más información, no dudes en escribirnos.

📞 *Contacto:* 341 414 1215
📍 *Visítanos:* Portal Morelos, Local 14

*¡Have a great day!* 😊

Escribe 'hola' para comenzar de nuevo.`);
        }

        // Mostrar ayuda
        function showHelp() {
            addBotMessage(`❓ *AYUDA - CÓMO USAR EL BOT*

🤖 Puedes interactuar conmigo de estas formas:

📝 *Por números:* Escribe el número de la opción que deseas
📱 *Por palabras:* Escribe lo que buscas como:
   • "precios" → Ver costos
   • "horarios" → Ver horarios
   • "ubicación" → Ver dónde estamos
   • "examen" → Info de ubicación

🔢 *Comandos útiles:*
   • "menu" → Volver al inicio
   • "ayuda" → Ver esta ayuda
   • "gracias" → Despedirse

¿En qué puedo ayudarte?`);
        }

        // Manejar login de estudiante
        function handleStudentLogin(matricula) {
            addBotMessage(`✅ *Matrícula validada: ${matricula}*

Accediendo a tu información...`, 1000);

            setTimeout(() => {
                addBotMessage(`👨‍🎓 *Bienvenido/a de vuelta!*

📊 *Tu información:*
• Nivel actual: B1 Intermediate
• Próxima clase: Hoy 18:00 hrs
• Mensualidad: Al día ✅

🔗 *Opciones rápidas:*
*1* Ver calificaciones
*2* Pagar mensualidad  
*3* Horario completo
*0* Volver al menú`);
                
                botState.currentState = 'portal_alumnos';
                updateDebugPanel();
            }, 2000);
        }

        // Mostrar error de opción inválida
        function showInvalidOptionError(input) {
            const validOptions = getValidOptionsForCurrentState();
            
            addBotMessage(`❌ La opción "${input}" no es válida.

📋 *Opciones disponibles:*
${validOptions}

💡 También puedes escribir palabras como "precios", "horarios", "ubicación" o "menu" para navegar.`, false, true);
        }

        // Obtener opciones válidas para el estado actual
        function getValidOptionsForCurrentState() {
            const currentStateData = responseMap[botState.currentState];
            if (!currentStateData) return "• Escribe 'menu' para volver al inicio";
            
            return Object.keys(currentStateData)
                .filter(key => !isNaN(key) || key.length <= 10)
                .map(key => `• ${key}`)
                .join('\n');
        }

        // Respuesta inteligente
        function handleIntelligentResponse(input) {
            const normalizedInput = input.toLowerCase();
            
            // Detectar intenciones comunes
            if (normalizedInput.includes('certificad') || normalizedInput.includes('titulo')) {
                goToState('info_certificaciones');
            } else if (normalizedInput.includes('nivel') || normalizedInput.includes('basico') || normalizedInput.includes('avanzado')) {
                goToState('info_niveles');
            } else if (normalizedInput.includes('pag') || normalizedInput.includes('mensualidad')) {
                goToState('info_metodos_pago');
            } else if (normalizedInput.includes('inscri') || normalizedInput.includes('registr')) {
                goToState('info_inscripcion');
            } else if (normalizedInput.includes('kid') || normalizedInput.includes('niño') || normalizedInput.includes('pequeño')) {
                addBotMessage(`👶 *CURSOS PARA NIÑOS*

🎯 Tenemos cursos especiales para niños de 7-10 años:
• $1,100/mes
• Martes y jueves 17:00-19:00
• Método especializado para su edad

*1* Ver más información sobre kids
*2* Ver precios generales
*0* Volver al menú`);
            } else {
                // Respuesta genérica con sugerencias
                addBotMessage(`🤔 No estoy seguro de entender "${input}".

💡 *Puedo ayudarte con:*
• Información de cursos y precios
• Horarios disponibles  
• Ubicación y contacto
• Examen de ubicación

📝 Escribe una palabra clave como "precios", "horarios" o "ubicación", o selecciona una opción del menú escribiendo 'menu'.`, false, true);
            }
        }

        // Mostrar mensaje de error
        function showErrorMessage(message) {
            addBotMessage(message, 1000, true);
        }

        // Agregar mensaje del usuario
        function addUserMessage(text) {
            const messageEl = createMessage(text, true);
            messagesContainer.appendChild(messageEl);
            scrollToBottom();
            
            // Actualizar historial
            botState.conversationHistory.push({
                type: 'user',
                message: text,
                timestamp: new Date()
            });
        }

        // Agregar mensaje del bot MEJORADO
        function addBotMessage(text, delay = 1500, isError = false) {
            showTyping();

            setTimeout(() => {
                hideTyping();
                const messageEl = createMessage(text, false, isError);
                messagesContainer.appendChild(messageEl);
                scrollToBottom();
                
                // Actualizar historial
                botState.conversationHistory.push({
                    type: 'bot',
                    message: text,
                    timestamp: new Date(),
                    error: isError
                });
                
                // Vibración y sonido
                if ('vibrate' in navigator) {
                    navigator.vibrate(isError ? [100, 50, 100] : 100);
                }
                
                playNotificationSound(isError);
            }, delay);
        }

        // Crear elemento de mensaje MEJORADO
        function createMessage(text, isSent, isError = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isSent ? 'sent' : 'received'}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = `message-content ${isError ? 'error-message' : ''}`;
            
            const textDiv = document.createElement('div');
            textDiv.className = 'message-text';
            textDiv.innerHTML = formatWhatsAppText(text);
            
            const timeDiv = document.createElement('div');
            timeDiv.className = 'message-time';
            const now = new Date();
            const timeStr = now.toLocaleTimeString('es-MX', { hour: '2-digit', minute: '2-digit' });
            
            if (isSent) {
                timeDiv.innerHTML = `${timeStr} <svg class="check-marks" viewBox="0 0 16 11" fill="#53bdeb"><path d="M11.071.653a.457.457 0 0 0-.304-.102.43.43 0 0 0-.304.102l-6.62 6.62-2.089-2.088a.43.43 0 0 0-.304-.102.457.457 0 0 0-.304.102l-.915.915a.458.458 0 0 0-.101.304.43.43 0 0 0 .101.304l2.946 2.946a.43.43 0 0 0 .305.102.457.457 0 0 0 .303-.102l7.88-7.88a.457.457 0 0 0 .102-.304.43.43 0 0 0-.102-.303z"/><path d="M15.276.653a.457.457 0 0 0-.303-.102.43.43 0 0 0-.304.102l-6.62 6.62-2.089-2.088a.43.43 0 0 0-.304-.102.457.457 0 0 0-.304.102l-.915.915a.458.458 0 0 0-.101.304.43.43 0 0 0 .101.304l2.946 2.946a.43.43 0 0 0 .305.102.457.457 0 0 0 .303-.102l7.88-7.88a.457.457 0 0 0 .102-.304.43.43 0 0 0-.102-.303z"/></svg>`;
            } else {
                timeDiv.textContent = timeStr;
            }
            
            contentDiv.appendChild(textDiv);
            contentDiv.appendChild(timeDiv);
            messageDiv.appendChild(contentDiv);
            
            return messageDiv;
        }

        // Formatear texto estilo WhatsApp
        function formatWhatsAppText(text) {
            return text
                .replace(/\*([^*]+)\*/g, '<strong>$1</strong>')
                .replace(/_([^_]+)_/g, '<em>$1</em>')
                .replace(/~([^~]+)~/g, '<del>$1</del>')
                .replace(/```([^`]+)```/g, '<code>$1</code>')
                .replace(/\n/g, '<br>');
        }

        // Mostrar indicador de escritura
        function showTyping() {
            typingIndicator.classList.add('show');
            scrollToBottom();
        }

        // Ocultar indicador de escritura
        function hideTyping() {
            typingIndicator.classList.remove('show');
        }

        // Scroll al final
        function scrollToBottom() {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Sonido de notificación mejorado
        function playNotificationSound(isError = false) {
            if (isError) {
                console.log('🔊 Error sound');
            } else {
                console.log('🔔 Notification sound');
            }
        }

        // Admin Panel (simplificado)
        function toggleAdminPanel() {
            toggleDebug();
        }

        // Exportar conversación
        function exportConversation() {
            let text = 'CONVERSACIÓN UNIVERSAL HOUSE BOT\n';
            text += '================================\n\n';
            
            botState.conversationHistory.forEach(entry => {
                const time = entry.timestamp.toLocaleTimeString('es-MX', { hour: '2-digit', minute: '2-digit' });
                text += `[${time}] ${entry.type === 'user' ? 'Usuario' : 'Bot'}: ${entry.message}\n\n`;
            });
            
            navigator.clipboard.writeText(text).then(() => {
                alert('¡Conversación copiada al portapapeles!');
            });
        }

        // Atajos de teclado
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'e':
                        e.preventDefault();
                        exportConversation();
                        break;
                    case 'd':
                        e.preventDefault();
                        toggleDebug();
                        break;
                    case 'r':
                        e.preventDefault();
                        showMainMenu();
                        break;
                }
            }
        });

        // Agregar botón de exportación
        function addExportButton() {
            const exportBtn = document.createElement('button');
            exportBtn.innerHTML = '📤';
            exportBtn.style.cssText = `
                position: fixed;
                bottom: 70px;
                right: 20px;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: #00a884;
                color: white;
                border: none;
                cursor: pointer;
                font-size: 16px;
                z-index: 1000;
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            `;
            exportBtn.onclick = exportConversation;
            exportBtn.title = 'Exportar conversación (Ctrl+E)';
            document.body.appendChild(exportBtn);
        }

        // FUNCIONES DE EDICIÓN Y EXPORTACIÓN MEJORADAS
        let editMode = false;
        
        function toggleEditMode() {
            editMode = !editMode;
            const btn = document.getElementById('editModeToggle');
            const messages = document.querySelectorAll('.message-text');
            
            if (editMode) {
                btn.classList.add('active');
                btn.innerHTML = '✏️ Modo Edición: ON';
                messages.forEach(msg => {
                    msg.contentEditable = true;
                    msg.classList.add('editing');
                });
                showNotification('🔴 MODO EDICIÓN ACTIVADO - Click en cualquier mensaje para editarlo');
            } else {
                btn.classList.remove('active');
                btn.innerHTML = '✏️ Modo Edición: OFF';
                messages.forEach(msg => {
                    msg.contentEditable = false;
                    msg.classList.remove('editing');
                });
                showNotification('✅ Modo edición desactivado');
            }
        }
        
        // Hacer mensajes editables al hacer click (solo en modo edición)
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('message-text') && editMode) {
                e.target.focus();
                // Seleccionar todo el texto
                const range = document.createRange();
                range.selectNodeContents(e.target);
                const sel = window.getSelection();
                sel.removeAllRanges();
                sel.addRange(range);
            }
        });
        
        // Guardar cambios al presionar Enter o perder foco
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && e.target.classList.contains('message-text') && editMode) {
                e.preventDefault();
                e.target.blur();
                showNotification('✅ Mensaje guardado');
            }
        });
        
        // Función de exportar mejorada
        function exportarChat() {
            const mensajes = document.querySelectorAll('.message');
            let texto = '=== CONVERSACIÓN WHATSAPP BOT UNIVERSAL HOUSE ===\n';
            texto += 'Fecha de exportación: ' + new Date().toLocaleString('es-MX') + '\n';
            texto += 'Total de mensajes: ' + mensajes.length + '\n';
            texto += '================================================\n\n';
            
            mensajes.forEach((mensaje, index) => {
                const esUsuario = mensaje.classList.contains('sent');
                const contenido = mensaje.querySelector('.message-text').innerText;
                const tiempo = mensaje.querySelector('.message-time')?.innerText || new Date().toLocaleTimeString('es-MX', { hour: '2-digit', minute: '2-digit' });
                
                texto += `[${tiempo}] ${esUsuario ? 'USUARIO' : 'BOT'}:\n`;
                texto += contenido + '\n\n';
            });
            
            texto += '\n=== FIN DE LA CONVERSACIÓN ===\n';
            texto += 'Exportado desde Universal House WhatsApp Bot Simulator';
            
            // Crear y descargar archivo
            const blob = new Blob([texto], { type: 'text/plain;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `UH-WhatsApp-Chat-${new Date().toISOString().slice(0,10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            // También copiar al portapapeles
            navigator.clipboard.writeText(texto).then(() => {
                showNotification('✅ Chat exportado exitosamente - Archivo descargado y copiado al portapapeles');
            }).catch(() => {
                showNotification('✅ Chat exportado y descargado');
            });
        }
        
        // Hacer que los nuevos mensajes también sean editables si el modo está activo
        const originalAddBotMessage = addBotMessage;
        addBotMessage = function(text, delay = 1500) {
            originalAddBotMessage(text, delay);
            if (editMode) {
                setTimeout(() => {
                    const messages = document.querySelectorAll('.message-text:not([contenteditable])');
                    messages.forEach(msg => {
                        msg.contentEditable = true;
                        msg.classList.add('editing');
                    });
                }, delay + 100);
            }
        };
        
        // Atajos de teclado
        document.addEventListener('keydown', (e) => {
            // Ctrl+E para modo edición
            if (e.ctrlKey && e.key === 'e') {
                e.preventDefault();
                toggleEditMode();
            }
            // Ctrl+S para exportar
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                exportarChat();
            }
        });
        
        // Notificación visual
        function showNotification(text) {
            const notif = document.createElement('div');
            notif.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #202c33;
                color: #e9edef;
                padding: 12px 24px;
                border-radius: 8px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.3);
                z-index: 10000;
                animation: slideDown 0.3s ease;
            `;
            notif.textContent = text;
            document.body.appendChild(notif);
            
            setTimeout(() => {
                notif.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }
        
        // Animaciones para notificaciones
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from { transform: translate(-50%, -100%); opacity: 0; }
                to { transform: translate(-50%, 0); opacity: 1; }
            }
            @keyframes slideUp {
                from { transform: translate(-50%, 0); opacity: 1; }
                to { transform: translate(-50%, -100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // Inicializar mejoras
        window.addEventListener('load', () => {
            // El botón de exportar ya está en el HTML
            
            // Auto-save de conversación cada 30 segundos
            setInterval(() => {
                if (botState.conversationHistory.length > 0) {
                    localStorage.setItem('uhbot_conversation', JSON.stringify(botState.conversationHistory));
                }
            }, 30000);
            
            // Mostrar ayuda inicial
            setTimeout(() => {
                showNotification('💡 Tip: Usa Ctrl+E para modo edición y Ctrl+S para exportar');
            }, 5000);
        });
    </script>
</body>
</html>
